# โ ุฅุตูุงุญ ุนุฑุถ ุฑุตูุฏ ุงููุชุงุฌุฑ ูู ุตูุญุฉ ุงูุญุณุงุจุงุช

## ุงููุดููุฉ
ูู ููู ุงูุฑุตูุฏ ุงูุญุงูู ูููุชุงุฌุฑ ูุธูุฑ ูู ุจุทุงูุฉ ูุนูููุงุช ุงููุชุฌุฑ ูู ุตูุญุฉ `accounts_page.dart` ููุณุชุฎุฏูู `networkOwner`.

## ุงูุณุจุจ ุงูุฌุฐุฑู
ุงููุธุงู ูุนุชูุฏ ุนูู ูุฌููุนุชูู:
1. **`vendors`** - ูุนูููุงุช ุงููุชุฌุฑ ุงูุฃุณุงุณูุฉ (ุงุณูุ ูุงุชูุ ูููุน...)
2. **`network_connections`** - ุงูุงุชุตุงู ุงููุนูู ุจูู ุงููุชุฌุฑ ูุงูุดุจูุฉ + ุงูุฑุตูุฏ ุงูุญูููู

### ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:
ุนูุฏ ุฅุถุงูุฉ ูุชุฌุฑ ุฌุฏูุฏ ุนุจุฑ `FirebaseVendorService.addVendor()`:
- โ ูุงู ูููุดุฆ ูุณุชูุฏ ูู `vendors`
- โ **ูู ููู** ูููุดุฆ ูุณุชูุฏ ููุงุจู ูู `network_connections`

ุงููุชูุฌุฉ:
- `_getVendorRealTimeData()` ูู `accounts_page.dart` ูุจุญุซ ุนู ูุณุชูุฏ ูู `network_connections`
- ูุง ูุฌุฏ ุดูุฆุงู โ ูุนูุฏ ููุฑุตูุฏ ุงูุงูุชุฑุงุถู ูู `VendorModel` (ุนุงุฏุฉ 0)
- ูุง ูุชู ุชุญุฏูุซ ุงูุฑุตูุฏ ุนูุฏ ุฅูุดุงุก ุทูุจุงุช ุฃู ุฏูุนุงุช

## ุงูุญู ุงูููุทุจู

### 1๏ธโฃ ุชุญุฏูุซ `firebase_vendor_service.dart`
ุฃุถูุช ุฏุงูุฉ `_createNetworkConnection()` ุงูุชู:
- ุชูุณุชุฏุนู ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ูุชุฌุฑ ุฌุฏูุฏ
- ุชููุดุฆ ูุณุชูุฏ ูู `network_connections` ุจุงูุจูุงูุงุช:
  - `vendorId`: ูุนุฑู ุงููุชุฌุฑ
  - `networkId`: ูุนุฑู ุงูุดุจูุฉ
  - `networkName`: ุงุณู ุงูุดุจูุฉ
  - `networkOwner`: ุตุงุญุจ ุงูุดุจูุฉ
  - `balance`: 0 (ุงูุฑุตูุฏ ุงูุงุจุชุฏุงุฆู)
  - `totalOrders`: 0
  - `isActive`: true
  - `connectedAt`: ุชุงุฑูุฎ ุงูุฅุถุงูุฉ

### 2๏ธโฃ ุฅุถุงูุฉ Logging ูู `accounts_page.dart`
ุฃุถูุช ุฑุณุงุฆู debug ูู `_getVendorRealTimeData()` ูุชุชุจุน:
- ูุนุฑู ุงููุชุฌุฑ ูุงูุดุจูุฉ
- ุนุฏุฏ ุงููุณุชูุฏุงุช ุงูููุฑุฌุนุฉ ูู `network_connections`
- ูููุฉ ุงูุฑุตูุฏ ุงููุนููุฉ
- ุงูุจูุงูุงุช ุงูุฎุงู ูู Firestore

## ุงููุชูุฌุฉ

### ูููุชุงุฌุฑ ุงูุฌุฏูุฏุฉ (ุจุนุฏ ุงูุชุญุฏูุซ):
โ ุนูุฏ ุฅุถุงูุฉ ูุชุฌุฑ:
1. ูููุดุฃ ูุณุชูุฏ ูู `vendors`
2. ูููุดุฃ ูุณุชูุฏ ูู `network_connections` ุชููุงุฆูุงู
3. ุงูุฑุตูุฏ ููุนุฑุถ ุจุดูู ุตุญูุญ = 0
4. ุนูุฏ ุฅูุดุงุก ุทูุจ โ ูุชุญุฏุซ `balance` ูู `network_connections`
5. ุนูุฏ ุฅุฑุณุงู ุฏูุนุฉ โ ูุชุญุฏุซ `balance` ูู `network_connections`
6. ุงูุชุญุฏูุซุงุช ุชุธูุฑ ููุฑุงู ูู ุจุทุงูุฉ ุงููุชุฌุฑ (real-time)

### ูููุชุงุฌุฑ ุงููุฏููุฉ (ูุจู ุงูุชุญุฏูุซ):
โ๏ธ ุงููุชุงุฌุฑ ุงูููุถุงูุฉ ูุจู ูุฐุง ุงูุฅุตูุงุญ **ูู ูุธูุฑ ููุง ุฑุตูุฏ** ุญุชู:
- ูุชู ุฅูุดุงุก ุงุชุตุงู ูุฏูู ูู `network_connections`
- ุฃู ููุนุงุฏ ุฅุถุงูุชูุง ูู ุฌุฏูุฏ

## ููููุฉ ุฅุตูุงุญ ุงููุชุงุฌุฑ ุงููุฏููุฉ

### ุงูุทุฑููุฉ 1: ุฅุตูุงุญ ุชููุงุฆู (ุณูุฑูุจุช)
```dart
// ูููู ุชุดุบููู ูุฑุฉ ูุงุญุฏุฉ ูู ุฃู ุตูุญุฉ
Future<void> fixOldVendorsConnections() async {
  final firestore = FirebaseFirestore.instance;
  
  // ุฌูุจ ุฌููุน ุงููุชุงุฌุฑ
  final vendorsSnapshot = await firestore.collection('vendors').get();
  
  for (final vendorDoc in vendorsSnapshot.docs) {
    final vendorId = vendorDoc.id;
    final vendorData = vendorDoc.data();
    final networkId = vendorData['networkId'] as String;
    
    // ุงูุชุญูู ูู ูุฌูุฏ ุงุชุตุงู
    final connectionSnapshot = await firestore
        .collection('network_connections')
        .where('vendorId', isEqualTo: vendorId)
        .where('networkId', isEqualTo: networkId)
        .get();
    
    if (connectionSnapshot.docs.isEmpty) {
      // ุฅูุดุงุก ุงูุงุชุตุงู ุงูููููุฏ
      await firestore.collection('network_connections').add({
        'vendorId': vendorId,
        'networkId': networkId,
        'networkName': vendorData['networkName'] ?? 'ุดุจูุฉ',
        'networkOwner': '', // ูููู ุฌูุจู ูู users
        'governorate': vendorData['governorate'] ?? '',
        'district': vendorData['district'] ?? '',
        'isActive': true,
        'connectedAt': vendorData['createdAt'] ?? Timestamp.now(),
        'balance': vendorData['balance'] ?? 0.0,
        'totalOrders': 0,
      });
      
      print('โ ุชู ุฅุตูุงุญ ุงุชุตุงู ุงููุชุฌุฑ: ${vendorData['name']}');
    }
  }
  
  print('๐ฏ ุชู ุงูุงูุชูุงุก ูู ุฅุตูุงุญ ุฌููุน ุงูุงุชุตุงูุงุช');
}
```

### ุงูุทุฑููุฉ 2: ุญุฐู ูุฅุนุงุฏุฉ ุฅุถุงูุฉ
1. ุงุญุฐู ุงููุชุฌุฑ ูู ูุงุฆูุฉ ุงููุชุงุฌุฑ
2. ุฃุนุฏ ุฅุถุงูุชู ูู ุงูุจุญุซ
3. ุณูุชู ุฅูุดุงุก ุงูุงุชุตุงู ุชููุงุฆูุงู

## ุงูุงุฎุชุจุงุฑ
1. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ `networkOwner`
2. ุฃุถู ูุชุฌุฑุงู ุฌุฏูุฏุงู ูู ุงูุจุญุซ
3. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงููุชุงุฌุฑ
4. ูุฌุจ ุฃู ุชุฑู ุงูุฑุตูุฏ = **+0 ุฑ.ู** (ุจุงูููู ุงูุฃุฎุถุฑ)
5. ุฃูุดุฆ ุทูุจ ุฌุฏูุฏ ูููุชุฌุฑ
6. ูุฌุจ ุฃู ูุชุญุฏุซ ุงูุฑุตูุฏ ููุฑุงู ูู ุจุทุงูุฉ ุงููุชุฌุฑ

## ููุงุญุธุงุช ูููุฉ
- ุงูุฑุตูุฏ **ุงูููุฌุจ** (ุฃุญูุฑ) = ุงููุชุฌุฑ ูุฏูู ููุดุจูุฉ
- ุงูุฑุตูุฏ **ุงูุณุงูุจ** (ุฃุฎุถุฑ) = ุงูุดุจูุฉ ุชุฏูู ูููุชุฌุฑ
- ุงูุฑุตูุฏ **ุตูุฑ** (ุฃุฎุถุฑ) = ูุง ุฏููู

## ุชุงุฑูุฎ ุงูุชุญุฏูุซ
**30 ุฃูุชูุจุฑ 2025** - ุชู ุชุทุจูู ุงูุฅุตูุงุญ ุจูุฌุงุญ

