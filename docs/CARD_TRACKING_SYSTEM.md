# ูุธุงู ุชุชุจุน ุงููุฑูุช ุงููุจุงุนุฉ

## ูุธุฑุฉ ุนุงูุฉ
ูุธุงู ูุชูุฏู ูุชุชุจุน ุงููุฑูุช ุงูุชู ูุชู ุจูุนูุง ูู ูุจู ุฃุตุญุงุจ ุงููุชุงุฌุฑ (POS Vendors) ูููููุง ุชููุงุฆูุงู ูู ุญุงูุฉ "ูููููุฉ ูููุชุงุฌุฑ" ุฅูู ุญุงูุฉ "ูุจุงุนุฉ".

## ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. ุฎุฏูุฉ ุงูุชุชุจุน (`FirebaseCardTrackingService`)

**ุงููููุน:** `lib/features/network_owner/data/services/firebase_card_tracking_service.dart`

#### ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ:

##### `watchSoldCards(String networkId)`
- **ุงููุตู:** ูุฑุงูุจุฉ ุงููุฑูุช ุงููุจุงุนุฉ ูู ุงูููุช ุงููุนูู
- **ุงูุขููุฉ:** ูุณุชูุน ููุชุบููุฑุงุช ุนูู ูุฑูุช ุงููุชุงุฌุฑ ููุญุฏุซ ุญุงูุชูุง ุชููุงุฆูุงู
- **ุงูุฅุฑุฌุงุน:** `Stream<List<CardModel>>`

```dart
// ูุซุงู ุงูุงุณุชุฎุฏุงู
final service = FirebaseCardTrackingService();
service.watchSoldCards(networkId).listen((soldCards) {
  print('ุชู ุงูุชุดุงู ${soldCards.length} ูุฑุช ูุจุงุน ุฌุฏูุฏ');
});
```

##### `_checkIfCardSoldByVendor(CardModel card)`
- **ุงููุตู:** ุงูุชุญูู ูู ุจูุน ุงููุฑุช ูู ูุจู ุงููุชุฌุฑ
- **ุงูุขููุฉ:** 
  1. ุงูุจุญุซ ูู ูุนุงููุงุช ุงููุชุงุฌุฑ (`vendor_transactions`)
  2. ุงูุจุญุซ ูู ุณุฌูุงุช ุงููุจูุนุงุช (`sales`)
- **ุงูุฅุฑุฌุงุน:** `Future<bool>`

##### `syncAllSoldCards(String networkId)`
- **ุงููุตู:** ูุฒุงููุฉ ุฌููุน ุงููุฑูุช ุงููุจุงุนุฉ (ุงุณุชุฎุฏุงู ููุฑุฉ ูุงุญุฏุฉ)
- **ุงูุงุณุชุฎุฏุงู:** ูููุฒุงููุฉ ุงููุฏููุฉ ุฃู ุงููุฒุงููุฉ ุงูุฃูููุฉ
- **ุงูุฅุฑุฌุงุน:** ุนุฏุฏ ุงููุฑูุช ุงูุชู ุชู ุชุญุฏูุซูุง

```dart
final updatedCount = await service.syncAllSoldCards(networkId);
print('ุชู ูุฒุงููุฉ $updatedCount ูุฑุช');
```

##### `startAutomaticTracking(String networkId)`
- **ุงููุตู:** ุชุดุบูู ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ูููุฑูุช ุงููุจุงุนุฉ
- **ุงูุขููุฉ:** ูุนูู ูู ุงูุฎูููุฉ ููุฑุงูุจ ุงูุชุบููุฑุงุช ุจุงุณุชูุฑุงุฑ

### 2. ุตูุญุฉ ุงููุฎุฒูู (`NetworkStoredPage`)

#### ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ:

##### 1. ุนุฑุถ ุงูุฌุฏูู ุจุนุฑุถ ุงูุดุงุดุฉ ุงููุงูู
```dart
child: SizedBox(
  width: MediaQuery.of(context).size.width,
  child: DataTable(...)
)
```

##### 2. ุฅุญุตุงุฆูุงุช ุฏููุงููููุฉ ุญุณุจ ุงูุชุจููุจ
- **ุงููุฑูุช ุงููุชุงุญุฉ:** ูุนุฑุถ ุฅุฌูุงูู ุงููุฑูุช ุงููุชุงุญุฉ
- **ุงููููููุฉ ูููุชุงุฌุฑ:** ูุนุฑุถ ุฅุฌูุงูู ุงููุฑูุช ุงููููููุฉ
- **ุงููุจุงุนุฉ:** ูุนุฑุถ ุฅุฌูุงูู ุงููุฑูุช ุงููุจุงุนุฉ

```dart
String totalLabel;
Color totalColor;
switch (_selectedView) {
  case 'available':
    totalLabel = 'ุงููุฑูุช ุงููุชุงุญุฉ';
    totalColor = AppColors.primary;
    break;
  case 'transferred':
    totalLabel = 'ุงููููููุฉ ูููุชุงุฌุฑ';
    totalColor = AppColors.blue500;
    break;
  case 'sold':
    totalLabel = 'ุงููุฑูุช ุงููุจุงุนุฉ';
    totalColor = AppColors.success;
    break;
}
```

##### 3. ุฒุฑ ุงููุฒุงููุฉ ุงููุฏููุฉ
- **ุงููููุน:** ุดุฑูุท ุงูุฃุฏูุงุช (AppBar)
- **ุงูุธููุฑ:** ููุท ุนูุฏ ุนุฑุถ ุชุจููุจ "ุงููููููุฉ ูููุชุงุฌุฑ"
- **ุงููุธููุฉ:** ูุฒุงููุฉ ุงููุฑูุช ุงููุจุงุนุฉ ูุฏููุงู
- **ุงููุคุดุฑ:** ูุนุฑุถ CircularProgressIndicator ุฃุซูุงุก ุงููุฒุงููุฉ

```dart
if (_selectedView == 'transferred')
  IconButton(
    icon: _isSyncing
        ? CircularProgressIndicator(...)
        : Icon(Icons.sync),
    onPressed: _isSyncing ? null : _syncSoldCards,
    tooltip: 'ูุฒุงููุฉ ุงููุฑูุช ุงููุจุงุนุฉ',
  ),
```

## ุขููุฉ ุงูุนูู

### 1. ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ

```mermaid
graph LR
    A[ุชูุนูู ุงููุฑุงูุจุฉ] --> B[ุงูุงุณุชูุงุน ููุชุบููุฑุงุช]
    B --> C[ุงูุชุดุงู ูุฑุช ููููู]
    C --> D{ูู ุชู ุจูุนูุ}
    D -->|ูุนู| E[ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู ูุจุงุน]
    D -->|ูุง| B
    E --> F[ุชุญุฏูุซ Firebase]
    F --> B
```

### 2. ุงููุฒุงููุฉ ุงููุฏููุฉ

```mermaid
graph TD
    A[ุงููุณุชุฎุฏู ูุถุบุท ุฒุฑ ุงููุฒุงููุฉ] --> B[ุฌูุจ ุฌููุน ุงููุฑูุช ุงููููููุฉ]
    B --> C[ูุญุต ูู ูุฑุช]
    C --> D{ุชู ุจูุนูุ}
    D -->|ูุนู| E[ุชุญุฏูุซ ุงูุญุงูุฉ]
    D -->|ูุง| F[ุชุฎุทู]
    E --> G[ุนุฏ ุงููุฑูุช ุงููุญุฏุซุฉ]
    F --> G
    G --> H[ุนุฑุถ ุงููุชูุฌุฉ ูููุณุชุฎุฏู]
```

## ุงูุชูุงูู ูุน ุงููุชุงุฌุฑ

### ูุตุงุฏุฑ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ:

1. **ูุนุงููุงุช ุงููุชุงุฌุฑ** (`vendor_transactions`)
   ```javascript
   {
     cardNumber: "1234567890",
     type: "sale",
     timestamp: "2025-01-15T10:30:00Z",
     vendorId: "vendor_123"
   }
   ```

2. **ุณุฌูุงุช ุงููุจูุนุงุช** (`sales`)
   ```javascript
   {
     cardNumber: "1234567890",
     status: "completed",
     saleDate: "2025-01-15T10:30:00Z",
     amount: 50.00
   }
   ```

## ุงูุฅุดุนุงุฑุงุช

### 1. ุฅุดุนุงุฑุงุช ุงููุฌุงุญ
```dart
CustomToast.success(
  context,
  'ุชู ุชุญุฏูุซ $updatedCount ูุฑุช ุฅูู ุญุงูุฉ (ูุจุงุน)',
  title: 'ุชูุช ุงููุฒุงููุฉ ุจูุฌุงุญ',
);
```

### 2. ุฅุดุนุงุฑุงุช ุงููุนูููุงุช
```dart
CustomToast.info(
  context,
  'ุฌููุน ุงููุฑูุช ูุญุฏุซุฉุ ูุง ุชูุฌุฏ ูุฑูุช ุฌุฏูุฏุฉ ูููุฒุงููุฉ',
  title: 'ูุง ุชูุฌุฏ ุชุญุฏูุซุงุช',
);
```

### 3. ุฅุดุนุงุฑุงุช ุงูุฃุฎุทุงุก
```dart
CustomToast.error(
  context,
  ErrorHandler.extractErrorMessage(e.toString()),
  title: 'ูุดูุช ุงููุฒุงููุฉ',
);
```

## ุงูุฃุฏุงุก ูุงูุชุญุณููุงุช

### 1. ุงููุฑุงูุจุฉ ุงูุฐููุฉ
- ุงุณุชุฎุฏุงู `Stream` ูููุฑุงูุจุฉ ูู ุงูููุช ุงููุนูู
- ุชุฌูุจ ุงูุชุญุฏูุซุงุช ุงููุชูุฑุฑุฉ ุจุงุณุชุฎุฏุงู `asyncMap`

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูู ุฌููุน ุงูุนูููุงุช
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุตูุฉ
- ุนุฏู ุชุนุทู ุงูุชุทุจูู ูู ุญุงูุฉ ุงูุฃุฎุทุงุก

### 3. ูุงุฌูุฉ ุงููุณุชุฎุฏู
- ูุคุดุฑุงุช ุชุญููู ูุงุถุญุฉ
- ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนู ูุชุงุฆุฌ ุงูุนูููุงุช
- ุชุตููู responsive ูุชููู ูุน ุญุฌู ุงูุดุงุดุฉ

## ุงูุงุณุชุฎุฏุงู

### 1. ุงูุชูุนูู ุงูุชููุงุฆู
ูุชู ุชูุนูู ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ุนูุฏ ูุชุญ ุตูุญุฉ ุงููุฎุฒูู:

```dart
@override
void initState() {
  super.initState();
  _loadCards();
  
  FirebaseCardCleanupService.scheduleAutomaticCleanup();
  
  // ุชูุนูู ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ูููุฑูุช ุงููุจุงุนุฉ
  final authProvider = Provider.of<AuthProvider>(context, listen: false);
  final networkId = authProvider.user?.id ?? '';
  if (networkId.isNotEmpty) {
    FirebaseCardTrackingService.startAutomaticTracking(networkId);
  }
}
```

### 2. ุงููุฒุงููุฉ ุงููุฏููุฉ
ูููุฒุงููุฉ ุงููุฏููุฉ:
1. ุงูุชุญ ุตูุญุฉ ุงููุฎุฒูู
2. ุงูุชูู ุฅูู ุชุจููุจ "ุงููููููุฉ ูููุชุงุฌุฑ"
3. ุงุถุบุท ุนูู ุฃููููุฉ ุงููุฒุงููุฉ (๐) ูู ุดุฑูุท ุงูุฃุฏูุงุช

## ุงูุตูุงูุฉ ูุงูุชุทููุฑ ุงููุณุชูุจูู

### ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:
1. ุฅุถุงูุฉ ููุงุชุฑ ุจุญุซ ูุชูุฏูุฉ
2. ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ ุงูุฅุญุตุงุฆูุฉ
3. ุฅุดุนุงุฑุงุช push ุนูุฏ ุจูุน ูุฑูุช
4. ููุญุฉ ุชุญูู ููุฅุญุตุงุฆูุงุช ุงููุจุงุดุฑุฉ
5. ุชูุงูู ูุน ุฃูุธูุฉ ุงูุฏูุน ุงูุฅููุชุฑููู

### ููุงุญุธุงุช ูููุฉ:
- ุงูุชุฃูุฏ ูู ุตูุงุญูุงุช Firebase ุงูุตุญูุญุฉ
- ูุฑุงุฌุนุฉ ุงูููุงุนุฏ ุงูุฃูููุฉ (Security Rules)
- ูุฑุงูุจุฉ ุงุณุชููุงู Firestore Reads
- ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก ูุน ุฃุนุฏุงุฏ ูุจูุฑุฉ ูู ุงููุฑูุช

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ
ูููุฒูุฏ ูู ุงููุนูููุงุชุ ุฑุงุฌุน:
- [ูุธุงู ุงูุจุงูุงุช ูุงููุฑูุช](PACKAGES_AND_CARDS_SYSTEM.md)
- [ูุธุงู ุงููุนุงููุงุช](TRANSACTIONS_SYSTEM.md)
- [ุฏููู Firebase](FIREBASE_CARDS_STORAGE.md)

