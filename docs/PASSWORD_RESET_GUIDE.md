# ุฏููู ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ ูุนูู ูู ุฎูุงู 3 ุฎุทูุงุช ุจุณูุทุฉ:
1. ุฅุฏุฎุงู ุฑูู ุงููุงุชู
2. ุงูุชุญูู ูู ููุฏ OTP
3. ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ

---

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู

### **ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู:**
1. ุงุถุบุท ุนูู **"ูู ูุณูุช ูููุฉ ุงูุณุฑุ"**
2. ุณูุชู ูููู ุชููุงุฆูุงู ูุตูุญุฉ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ
3. **ููุงุญุธุฉ:** ุฑูู ุงููุงุชู ุงูุฐู ุฃุฏุฎูุชู ุณููููุฃ ุชููุงุฆูุงู

---

## ๐ ุงูุฎุทูุงุช ุงูุชูุตูููุฉ

### **ุงูุฎุทูุฉ 1: ุฅุฏุฎุงู ุฑูู ุงููุงุชู**

```
๐ฑ ุฃุฏุฎู ุฑูู ุงููุงุชู ุงููุฑุชุจุท ุจุญุณุงุจู
   ูุซุงู: 777123456

โ ูุชู ุงูุชุญูู ูู:
   - ูุฌูุฏ ุงูุญุณุงุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุตุญุฉ ุฑูู ุงููุงุชู ุงููููู

๐ค ุงููุธุงู ูููู ุจู:
   - ุชูููุฏ ููุฏ OTP (6 ุฃุฑูุงู)
   - ุทุจุงุนุชู ูู Debug Console
   - ุญูุธู ูู Firestore ูุน ููุช ุงูุงูุชูุงุก (5 ุฏูุงุฆู)
```

### **ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูููุฏ**

```
๐ข ุฃุฏุฎู ููุฏ ุงูุชุญูู (6 ุฃุฑูุงู)
   
โฑ๏ธ ุงูููุฏ ุตุงูุญ ููุฏุฉ: 5 ุฏูุงุฆู

โ ูุชู ุงูุชุญูู ูู:
   - ุตุญุฉ ุงูููุฏ
   - ุนุฏู ุงูุชูุงุก ุตูุงุญูุฉ ุงูููุฏ
   - ูุทุงุจูุฉ ุฑูู ุงููุงุชู

๐ ููุงุญุธุฉ:
   ูู Debug Console ุณุชุฌุฏ ุงูููุฏ ูุทุจูุน ูุงูุชุงูู:
   "OTP ูุงุณุชุนุงุฏุฉ ุงูุญุณุงุจ (777123456): 123456"
```

### **ุงูุฎุทูุฉ 3: ุชุนููู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ**

```
๐ ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
   - ุงูุญุฏ ุงูุฃุฏูู: 6 ุฃุญุฑู

๐ ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ
   - ูุฌุจ ุฃู ุชุทุงุจู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ

โ ุจุนุฏ ุงููุฌุงุญ:
   - ูุชู ุญูุธ ูููุฉ ุงููุฑูุฑ ูู Firestore ูุคูุชุงู
   - ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ุงูุชุงููุ ูุชู ุชุทุจูููุง ุชููุงุฆูุงู
   - ููููู ุชุณุฌูู ุงูุฏุฎูู ููุฑุงู ุจูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
```

---

## ๐ง ููู ูุนูู ุงููุธุงู ุชูููุงู

### **1. ุฅุฑุณุงู ุทูุจ ุงูุงุณุชุนุงุฏุฉ:**
```dart
// ูู AuthProvider
Future<bool> startPasswordRecovery(String phone) {
  1. ุงูุชุญูู ูู ุตุญุฉ ุฑูู ุงููุงุชู
  2. ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ูู Firestore
  3. ุชูููุฏ OTP ุนุดูุงุฆู (6 ุฃุฑูุงู)
  4. ุญูุธู ูุน ููุช ุงูุชูุงุก (5 ุฏูุงุฆู)
  5. ุทุจุงุนุฉ ุงูููุฏ ูู Console
}
```

### **2. ุงูุชุญูู ูู ุงูููุฏ:**
```dart
bool verifyPasswordResetOtp(String phone, String otp) {
  1. ุงูุชุญูู ูู ูุฌูุฏ ุทูุจ ุงุณุชุนุงุฏุฉ
  2. ุงูุชุญูู ูู ูุทุงุจูุฉ ุฑูู ุงููุงุชู
  3. ุงูุชุญูู ูู ุนุฏู ุงูุชูุงุก ุงูุตูุงุญูุฉ
  4. ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏ
  5. ุชุญุฏูุฏ ุงูููุฏ ูููุชุญูู ููู
}
```

### **3. ุชุนููู ูููุฉ ุงููุฑูุฑ:**
```dart
Future<bool> completePasswordReset({
  required String phone,
  required String otp,
  required String newPassword,
}) {
  1. ุงูุชุญูู ูู ุฌููุน ุงูุดุฑูุท
  2. ุญูุธ ูููุฉ ุงููุฑูุฑ ูู Firestore ูุคูุชุงู
  3. ูุถุน ุนูุงูุฉ verified: true
  4. ุชูุธูู ุงูุจูุงูุงุช ุงููุคูุชุฉ
}
```

### **4. ุชุทุจูู ูููุฉ ุงููุฑูุฑ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:**
```dart
Future<void> _applyPendingPasswordReset(String userId) {
  1. ุงูุชุญูู ูู ูุฌูุฏ ุทูุจ ุฅุนุงุฏุฉ ุชุนููู
  2. ุงูุชุญูู ูู ุนูุงูุฉ verified
  3. ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ูู Firebase Auth
  4. ุญุฐู ุทูุจ ุฅุนุงุฏุฉ ุงูุชุนููู
}
```

---

## ๐ฏ ูุซุงู ุนููู

### **ุงูุณููุงุฑูู:**
ูุณุชุฎุฏู ูุณู ูููุฉ ูุฑูุฑู ูุฑูู ูุงุชูู `777123456`

### **ุงูุฎุทูุงุช:**

**1. ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู:**
```
- ูุถุบุท "ูู ูุณูุช ูููุฉ ุงูุณุฑุ"
- ูุชู ูุชุญ ุตูุญุฉ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ
- ุฑูู ุงููุงุชู (777123456) ููููุฃ ุชููุงุฆูุงู
```

**2. ุงูุฎุทูุฉ 1 - ุฑูู ุงููุงุชู:**
```
[ุฑูู ุงููุงุชู: 777123456] โ ููููุฃ ุชููุงุฆูุงู
[ุฒุฑ: ุงูุชุงูู]

โ ุจุนุฏ ุงูุถุบุท โ

Debug Console:
"OTP ูุงุณุชุนุงุฏุฉ ุงูุญุณุงุจ (777123456): 456789"
```

**3. ุงูุฎุทูุฉ 2 - ููุฏ ุงูุชุญูู:**
```
[ููุฏ ุงูุชุญูู: 456789] โ ุฃุฏุฎู ุงูููุฏ ูู Console
[ุฒุฑ: ุงูุชุงูู]

โ ุจุนุฏ ุงูุถุบุท โ

"ุชู ุงูุชุญูู ูู ุงูููุฏ ุจูุฌุงุญ โ"
```

**4. ุงูุฎุทูุฉ 3 - ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ:**
```
[ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ: ******]
[ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ: ******]
[ุฒุฑ: ุฅุฑุณุงู ูุงุณุชููุงู]

โ ุจุนุฏ ุงูุถุบุท โ

Firestore:
password_reset_requests/{userId}:
{
  "phone": "777123456",
  "newPassword": "newpass123",
  "verified": true,
  "requestedAt": (Timestamp)
}
```

**5. ุงูุนูุฏุฉ ูุชุณุฌูู ุงูุฏุฎูู:**
```
- ููุนุงุฏ ุชูุฌููู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
- ุฑูู ุงููุงุชู: 777123456
- ูููุฉ ุงููุฑูุฑ: newpass123 โ ุงูุฌุฏูุฏุฉ
- [ุชุณุฌูู ุงูุฏุฎูู]

โ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู โ

Debug Console:
"๐ ุชุทุจูู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ..."
"โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ"

Firebase Auth:
- ูููุฉ ุงููุฑูุฑ ูุญุฏุซุฉ
- ููููู ุชุณุฌูู ุงูุฏุฎูู ุจุงููููุฉ ุงูุฌุฏูุฏุฉ ุฏุงุฆูุงู
```

---

## ๐ ุงูุฑุจุท ูุน ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

### **ูู Login โ Forgot Password:**
```dart
// ูู login_page.dart
TextButton(
  onPressed: () {
    final phone = _phoneController.text.trim();
    context.push('/forgot-password', extra: {
      if (phone.isNotEmpty) 'phone': phone,
    });
  },
  child: Text('ูู ูุณูุช ูููุฉ ุงูุณุฑุ'),
)
```

### **ูู Forgot Password โ Login:**
```dart
// ูู forgot_password_page.dart

// ุฒุฑ ุงูุฅูุบุงุก/ุงูุณุงุจู:
void _handleBack() {
  if (_currentStep == 0) {
    context.go('/login');  // ุงูุนูุฏุฉ ููุชุณุฌูู
  } else {
    _currentStep -= 1;     // ุงูุฎุทูุฉ ุงูุณุงุจูุฉ
  }
}

// ุจุนุฏ ุงููุฌุงุญ:
if (success) {
  context.go('/login');    // ุงูุนูุฏุฉ ููุชุณุฌูู
}
```

### **Router Configuration:**
```dart
// ูู app_router.dart
final publicRoutes = ['/login', '/register', '/forgot-password'];

// ุงูุณูุงุญ ุจุงููุตูู ููุตูุญุฉ ุจุฏูู ุชุณุฌูู ุฏุฎูู โ
```

---

## ๐ก๏ธ ุงูุฃูุงู ูุงูุชุญูู

### **1. ุงูุชุญูู ูู ุฑูู ุงููุงุชู:**
```dart
โ ูุฌุจ ุฃู ูููู ุฑูู ูููู ุตุญูุญ (9 ุฃุฑูุงู)
โ ูุจุฏุฃ ุจู: 777, 733, 770, ุฅูุฎ
โ ูุฌุจ ุฃู ูููู ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

### **2. ุงูุชุญูู ูู OTP:**
```dart
โ ุตุงูุญ ููุฏุฉ 5 ุฏูุงุฆู ููุท
โ ูุฌุจ ุฃู ูุทุงุจู ุงูููุฏ ุงูููุฑุณู
โ ูุฌุจ ุฃู ูุทุงุจู ุฑูู ุงููุงุชู
```

### **3. ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ:**
```dart
โ ุงูุญุฏ ุงูุฃุฏูู: 6 ุฃุญุฑู
โ ูุฌุจ ุชุฃููุฏูุง
โ ุชูุญูุธ ูุดูุฑุฉ ูู Firebase Auth
```

### **4. ุงูุญูุงูุฉ ูู ุฅุณุงุกุฉ ุงูุงุณุชุฎุฏุงู:**
```dart
โ OTP ููุชูู ุจุนุฏ 5 ุฏูุงุฆู
โ ุทูุจ ูุงุญุฏ ูุดุท ูู ูู ูุฑุฉ
โ ูุฌุจ ุงูุชุญูู ูู ุงูููุฏ ูุจู ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
โ ูููุฉ ุงููุฑูุฑ ุชูุทุจู ููุท ุจุนุฏ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
```

---

## ๐ Firestore Structure

### **Collection: `password_reset_requests`**

```json
{
  "password_reset_requests": {
    "userId_123": {
      "phone": "777123456",
      "newPassword": "encrypted_password",
      "verified": true,
      "requestedAt": "2025-10-26T10:30:00Z"
    }
  }
}
```

**ุงูุญููู:**
- `phone`: ุฑูู ุงููุงุชู ุงูููุฑุชุจุท
- `newPassword`: ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ (ูุคูุชุงู)
- `verified`: ุชู ุงูุชุญูู ูู OTPุ
- `requestedAt`: ููุช ุงูุทูุจ

---

## ๐จ UI/UX Features

### **1. ูุคุดุฑ ุงูุฎุทูุงุช:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โโโโโโโโกโโโโโโโข                โ
โ  ุฑูู    ููุฏ    ูููุฉ             โ
โ  ุงููุงุชู ุงูุชุญูู ุงููุฑูุฑ            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### **2. ุงูุชููู:**
```
โ ุฒุฑ ุฑุฌูุน:
  - ุงูุฎุทูุฉ 1: ุงูุนูุฏุฉ ูุชุณุฌูู ุงูุฏุฎูู
  - ุงูุฎุทูุฉ 2-3: ุงูุฎุทูุฉ ุงูุณุงุจูุฉ

โ ุฒุฑ ุงูุชุงูู:
  - ุงูุฎุทูุฉ 1-2: "ุงูุชุงูู"
  - ุงูุฎุทูุฉ 3: "ุฅุฑุณุงู ูุงุณุชููุงู"
```

### **3. ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูููุฏ:**
```
ูู ุงูุฎุทูุฉ 2ุ ูุธูุฑ ุฒุฑ:
"ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูููุฏ"

- ููุฑุณู OTP ุฌุฏูุฏ
- ููุทุจุน ูู Debug Console
```

### **4. ุฑุณุงุฆู ูุงุถุญุฉ:**
```
โ ูุฌุงุญ: ุฎูููุฉ ุฎุถุฑุงุก + ุนูุงูุฉ โ
โ ูุดู: ุฎูููุฉ ุญูุฑุงุก + ุฑุณุงูุฉ ุงูุฎุทุฃ
โน๏ธ ูุนูููุงุช: ูุฑุจุน ุฃุฒุฑู ูุน ุฃููููุฉ
```

---

## ๐ Debugging

### **ูู Debug Console ุณุชุฌุฏ:**

**ุนูุฏ ุจุฏุก ุงูุงุณุชุนุงุฏุฉ:**
```
OTP ูุงุณุชุนุงุฏุฉ ุงูุญุณุงุจ (777123456): 456789
```

**ุนูุฏ ุญูุธ ูููุฉ ุงููุฑูุฑ:**
```
โ ุชู ุญูุธ ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ ูุคูุชุงู ูู: 777123456
โ๏ธ ููุงุญุธุฉ: ูุฌุจ ุชุทุจูู ูููุฉ ุงููุฑูุฑ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ุงูุชุงูู
```

**ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ุจุนุฏ ุงูุงุณุชุนุงุฏุฉ:**
```
๐ ุชุทุจูู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ...
โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ
```

---

## โ๏ธ Troubleshooting

### **ูุดููุฉ: "ูู ูุชู ุงูุนุซูุฑ ุนูู ุญุณุงุจ"**
**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุฑูู ุงููุงุชู ูุณุฌู ูู `users` collection
- ุชุญูู ูู ุตุญุฉ ุงูุฑูู (9 ุฃุฑูุงูุ ูููู)

### **ูุดููุฉ: "ููุฏ ุงูุชุญูู ุบูุฑ ุตุญูุญ"**
**ุงูุญู:**
- ุงูุชุญ Debug Console
- ุงุจุญุซ ุนู: "OTP ูุงุณุชุนุงุฏุฉ ุงูุญุณุงุจ"
- ุงูุณุฎ ุงูููุฏ ุงููุทุจูุน

### **ูุดููุฉ: "ุงูุชูุช ุตูุงุญูุฉ ููุฏ ุงูุชุญูู"**
**ุงูุญู:**
- ุงุถุบุท "ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูููุฏ"
- ุงุณุชุฎุฏู ุงูููุฏ ุงูุฌุฏูุฏ ูู Debug Console

### **ูุดููุฉ: "ูุง ูุนูู ุชุณุฌูู ุงูุฏุฎูู ุจูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ"**
**ุงูุญู:**
- ุชุฃูุฏ ูู ุฅููุงู ุฌููุน ุงูุฎุทูุงุช ุจูุฌุงุญ
- ุณุฌู ุฏุฎูู ุจูููุฉ ุงููุฑูุฑ ุงููุฏููุฉ ูุฑุฉ ูุงุญุฏุฉ (ูุชุทุจูู ุงูุฌุฏูุฏุฉ)
- ุฃู ุงูุชุธุฑ ููููุงู ูุญุงูู ูุฑุฉ ุฃุฎุฑู

---

## ๐ Security Rules

ุชุฃูุฏ ูู ูุฌูุฏ ุงูููุงุนุฏ ุงูุชุงููุฉ ูู `firestore.rules`:

```javascript
match /password_reset_requests/{userId} {
  allow read, write: if request.auth != null;
}
```

---

## ๐ฑ Flow Chart

```
โโโโโโโโโโโโโโโโโโโ
โ  Login Page     โ
โ  "ูุณูุช ูููุฉ    โ
โ   ุงูุณุฑุ"        โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Forgot Pass    โ
โ  Step 1: Phone  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ [ุงูุชุงูู]
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Step 2: OTP    โ
โ  [ุฅุนุงุฏุฉ ุฅุฑุณุงู]  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ [ุงูุชุงูู]
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Step 3: Pass   โ
โ  [ุชุฃููุฏ]        โ
โโโโโโโโโโฌโโโโโโโโโ
         โ [ุฅุฑุณุงู]
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Firestore      โ
โ  Save temp pass โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Login Page     โ
โ  "ููููู ุงูุฏุฎูู" โ
โโโโโโโโโโฌโโโโโโโโโ
         โ [ุชุณุฌูู ุฏุฎูู]
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Auth Provider  โ
โ  Apply new pass โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
โโโโโโโโโโโโโโโโโโโ
โ  Firebase Auth  โ
โ  Password โ    โ
โโโโโโโโโโโโโโโโโโโ
```

---

## โ **ุงูุชุญุณููุงุช ุงููุทุจูุฉ:**

1. โ **Router ูุญุฏุซ:** ุงูุณูุงุญ ุจุงููุตูู ูู `/forgot-password` ุจุฏูู ุชุณุฌูู ุฏุฎูู
2. โ **ุฑุณุงุฆู ูุญุณูุฉ:** ุฑุณุงุฆู ูุงุถุญุฉ ููููููุฉ
3. โ **ุชุทุจูู ุชููุงุฆู:** ูููุฉ ุงููุฑูุฑ ุชูุทุจู ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
4. โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:** ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูู ูู ุฎุทูุฉ
5. โ **UI ูุญุณูุฉ:** ูุฑุจุน ูุนูููุงุช ูู ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ
6. โ **Debug ูุงุถุญ:** ุทุจุงุนุฉ ุชูุตูููุฉ ูู Console

---

## ๐ **ุงูุขู ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

**ุฌุฑูุจ:**
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงุถุบุท "ูู ูุณูุช ูููุฉ ุงูุณุฑุ"
3. ุงุชุจุน ุงูุฎุทูุงุช
4. ุชุญูู ูู Debug Console ููุญุตูู ุนูู OTP
5. ุงุณุชูุชุน ุจูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ! โจ

