# ูุธุงู ุงููุนุงููุงุช ุงููุงููุฉ - Transactions System

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญููู ุตูุญุฉ ูุนุงููุงุช ุงููุชุฌุฑ ูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุฅูู ูุธุงู ุญูููู ูุชูุงูู ูุน Firebase.

---

## ๐๏ธ ุงููููู ุงูููู

### 1. Models
- **`TransactionModel`**: ูููุฐุฌ ุงููุนุงููุฉ ุงููุงููุฉ
- **`VendorModel`**: ูุนูููุงุช ุงููุชุฌุฑ

### 2. Services
- **`FirebaseTransactionService`**: ุฎุฏูุฉ Firebase ูุฅุฏุงุฑุฉ ุงููุนุงููุงุช

### 3. Pages
- **`MerchantTransactionsPage`**: ุตูุญุฉ ุนุฑุถ ูุนุงููุงุช ุงููุชุฌุฑ

---

## ๐ฅ ุฅุนุฏุงุฏ Firebase

### 1. Collection Structure

**Collection: `transactions`**

ูู ูุนุงููุฉ ุชุญุชูู ุนูู:
```json
{
  "vendorId": "vendor_123",           // ูุนุฑู ุงููุชุฌุฑ
  "networkId": "network_456",         // ูุนุฑู ุงูุดุจูุฉ
  "date": "2025-10-26T10:00:00Z",    // ุชุงุฑูุฎ ุงููุนุงููุฉ
  "type": "charge",                   // ุงูููุน
  "amount": 1500,                     // ุงููุจูุบ
  "description": "ุจูุน 10 ูุฑูุช",      // ุงููุตู
  "reference": "ORD-20251026-001",    // ุงููุฑุฌุน
  "status": "completed",              // ุงูุญุงูุฉ
  "balanceAfter": 5000,               // ุงูุฑุตูุฏ ุจุนุฏ ุงููุนุงููุฉ
  "createdBy": "user_id",             // ูู ุฃูุดุฃ ุงููุนุงููุฉ
  "method": "cash",                   // ุทุฑููุฉ ุงูุฏูุน (ุงุฎุชูุงุฑู)
  "notes": "ููุงุญุธุงุช"                  // ููุงุญุธุงุช (ุงุฎุชูุงุฑู)
}
```

---

### 2. ุฃููุงุน ุงููุนุงููุงุช

| ุงูููุน | ุงููุตู | ุงูุชุฃุซูุฑ ุนูู ุงูุฑุตูุฏ |
|-------|-------|-------------------|
| `charge` | ุจูุน ูุฑูุช / ูุณุชุญูุงุช | โ ุฒูุงุฏุฉ (ุฏูู ุนูู ุงููุชุฌุฑ) |
| `payment` | ุฏูุนุฉ ูู ุงููุชุฌุฑ | โ ููุต (ุชุณุฏูุฏ) |
| `refund` | ุงุณุชุฑุฌุงุน / ูุฑุชุฌุน | โ ููุต (ุฎุตู) |
| `fee` | ุฑุณูู ุฎุฏูุฉ | โ ุฒูุงุฏุฉ |
| `adjustment` | ุชุณููุฉ ุญุณุงุจ | โ/โ ุญุณุจ ุงููููุฉ |

---

### 3. ุญุงูุงุช ุงููุนุงููุฉ

| ุงูุญุงูุฉ | ุงููุตู |
|-------|-------|
| `completed` | ููุชููุฉ ููุคูุฏุฉ |
| `pending` | ูู ุงูุงูุชุธุงุฑ |
| `failed` | ูุดูุช |

---

### 4. ุทุฑู ุงูุฏูุน

| ุงูุทุฑููุฉ | ุงููุตู |
|---------|-------|
| `cash` | ููุฏุงู |
| `bank_transfer` | ุชุญููู ุจููู |
| `mobile_wallet` | ูุญูุธุฉ ุฅููุชุฑูููุฉ |

---

## ๐ ููุงุนุฏ ุงูุฃูุงู

ุชู ุฅุถุงูุฉ ุงูููุงุนุฏ ุงูุชุงููุฉ ูู `firestore.rules`:

```javascript
match /transactions/{transactionId} {
  // ุงููุฑุงุกุฉ: ููุท ููุดุจูุฉ ุงููุงููุฉ
  allow read: if isAuthenticated() && 
                 resource.data.networkId == request.auth.uid;
  
  // ุงูุฅูุดุงุก: ููุท ูุงูู ุงูุดุจูุฉ
  allow create: if isAuthenticated() && 
                   request.resource.data.networkId == request.auth.uid;
  
  // ุงูุชุญุฏูุซ ูุงูุญุฐู: ููุท ูุงูู ุงูุดุจูุฉ
  allow update, delete: if isAuthenticated() && 
                           resource.data.networkId == request.auth.uid;
}
```

---

## ๐ ุงูููุงุฑุณ ุงููุทููุจุฉ

ูู `firestore.indexes.json`:

```json
{
  "collectionGroup": "transactions",
  "queryScope": "COLLECTION",
  "fields": [
    {
      "fieldPath": "vendorId",
      "order": "ASCENDING"
    },
    {
      "fieldPath": "networkId",
      "order": "ASCENDING"
    },
    {
      "fieldPath": "date",
      "order": "DESCENDING"
    }
  ]
}
```

**ููุดุฑ ุงูููุงุฑุณ:**
```bash
firebase deploy --only firestore:indexes
```

---

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุงููุตูู ูุตูุญุฉ ุงููุนุงููุงุช

**ูู ุตูุญุฉ ุงููุชุงุฌุฑ:**
1. ุงุฐูุจ ุฅูู **"ุงููุชุงุฌุฑ"**
2. ุงุถุบุท ุนูู **ุฃู ูุชุฌุฑ**
3. **ุณุชูุชุญ ุตูุญุฉ ูุนุงููุงุช ุงููุชุฌุฑ** โจ

---

### 2. ุนุฑุถ ุงูุจูุงูุงุช

**ุงูุตูุญุฉ ุชุนุฑุถ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ูุนูููุงุช ุงููุชุฌุฑ:                โ
โ  ๐ฆ ูุชุฌุฑ ุงูููุฑ                   โ
โ  ๐ค ุฃุญูุฏ ูุญูุฏ                    โ
โ  ๐ 777123456                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงูุฑุตูุฏ ุงูุญุงูู:                 โ
โ  +5,000 ุฑ.ู                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงููุณุชุญูุงุช    โ  ุงููุฏููุนุงุช       โ
โ  45,000       โ  38,000          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ุงููุนุงููุงุช (12)                  โ
โ                                   โ
โ  โ๏ธ ุจูุน 10 ูุฑูุช     +1,500      โ
โ  ORD-001 โข 25/10/2025            โ
โ                                   โ
โ  โ๏ธ ุฏูุนุฉ ููุฏูุฉ      -5,000      โ
โ  PAY-001 โข 24/10/2025            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐พ ุฅุถุงูุฉ ูุนุงููุงุช ุชุฌุฑูุจูุฉ

ูู Firebase Console โ `transactions`:

### ูุนุงููุฉ 1: ุจูุน ูุฑูุช
```
Document ID: (Auto-generated)

Fields:
vendorId: "{vendor_id}"        โ ูุนุฑู ุงููุชุฌุฑ
networkId: "{network_id}"      โ ูุนุฑู ุงูุดุจูุฉ
date: (Timestamp - ุงูุขู)
type: "charge"
amount: 1500
description: "ุจูุน 10 ูุฑูุช ุจุงูุฉ ููููุฉ"
reference: "ORD-20251026-001"
status: "completed"
balanceAfter: 5000
createdBy: "{network_id}"
method: "cash"
```

### ูุนุงููุฉ 2: ุฏูุนุฉ ููุฏูุฉ
```
Document ID: (Auto-generated)

Fields:
vendorId: "{vendor_id}"
networkId: "{network_id}"
date: (Timestamp - ุงูุขู - ููู ูุงุญุฏ)
type: "payment"
amount: -5000                   โ ุณุงูุจ ููุฏูุนุงุช
description: "ุฏูุนุฉ ููุฏูุฉ ูู ุงููุชุฌุฑ"
reference: "PAY-20251025-001"
status: "completed"
balanceAfter: 3500
createdBy: "{network_id}"
method: "cash"
notes: "ุฏูุนุฉ ูุณุชููุฉ ูู ุงูููุชุจ"
```

### ูุนุงููุฉ 3: ุงุณุชุฑุฌุงุน
```
vendorId: "{vendor_id}"
networkId: "{network_id}"
date: (Timestamp)
type: "refund"
amount: -300                    โ ุณุงูุจ ููุงุณุชุฑุฌุงุน
description: "ุงุณุชุฑุฌุงุน ูุฑุช ูุนุทู"
reference: "REF-20251024-001"
status: "completed"
balanceAfter: 8500
createdBy: "{network_id}"
method: "cash"
notes: "ูุฑุช ูุนุทู ุชูููุงู"
```

---

## ๐ ููู ูุนูู ุงููุธุงู

### 1. ุชุญููู ูุนุงููุงุช ุงููุชุฌุฑ
```dart
FirebaseTransactionService.getTransactionsByVendor(
  vendorId: vendorId,
  networkId: networkId,
)
```

### 2. ุญุณุงุจ ููุฎุต ุงูุญุณุงุจ
```dart
final summary = await FirebaseTransactionService.getAccountSummary(
  vendorId: vendorId,
  networkId: networkId,
);

// ุงููุชูุฌุฉ:
{
  'totalCharges': 45000,      // ุฅุฌูุงูู ุงููุณุชุญูุงุช
  'totalPayments': 38000,     // ุฅุฌูุงูู ุงููุฏููุนุงุช
  'currentBalance': 7000,     // ุงูุฑุตูุฏ ุงูุญุงูู
  'totalTransactions': 156,   // ุนุฏุฏ ุงููุนุงููุงุช
  'lastTransactionDate': ...  // ุขุฎุฑ ูุนุงููุฉ
}
```

### 3. ุนุฑุถ ุงููุนุงููุงุช
- โ **StreamBuilder**: ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุฅุถุงูุฉ ูุนุงููุงุช ุฌุฏูุฏุฉ
- โ **ุชุฑุชูุจ**: ูู ุงูุฃุญุฏุซ ููุฃูุฏู
- โ **ุฃููุงู**: ุฃุฎุถุฑ ููุฒูุงุฏุฉุ ุฃุญูุฑ ููููุต
- โ **ุฃููููุงุช**: ูุฎุชููุฉ ููู ููุน

---

## ๐ฏ ุงูููุฒุงุช

โ **ุนุฑุถ ุญูููู ูู Firebase**  
โ **ุชุญุฏูุซ ุชููุงุฆู (real-time)**  
โ **ููุฎุต ุญุณุงุจ ุฏููู**  
โ **ุนุฑุถ ุชูุตููู ููู ูุนุงููุฉ**  
โ **ุชุตููู ุญุณุจ ุงูููุน**  
โ **ุฑุตูุฏ ูุชุฌุฏุฏ**  

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ุฃุถู ูุชุฌุฑ
- ูู ุตูุญุฉ ุงููุชุงุฌุฑ โ ุงุจุญุซ โ ุฃุถู ูุชุฌุฑ

### 2. ุฃุถู ูุนุงููุงุช ูู Firebase Console
- ุงุฐูุจ ุฅูู `transactions`
- ุฃุถู ูุนุงููุงุช ูููุชุฌุฑ ุงููุถุงู

### 3. ุดุงูุฏ ุงููุชุงุฆุฌ
- ุงุถุบุท ุนูู ุงููุชุฌุฑ ูู ูุงุฆูุฉ ุงููุชุงุฌุฑ
- **ุณุชุธูุฑ ุงููุนุงููุงุช ุงูุญููููุฉ!** โจ

---

## ๐ ููุงุญุธุงุช

### ุฑุตูุฏ ุงููุชุฌุฑ
- **ููุญุฏูุซ ุชููุงุฆูุงู** ูู collection `vendors`
- **ููุญุณุจ** ูู ุฌููุน ุงููุนุงููุงุช
- **ุฅูุฌุงุจู**: ุงููุชุฌุฑ ูุฏูู ููุดุจูุฉ
- **ุณูุจู**: ุงูุดุจูุฉ ูุฏููุฉ ูููุชุฌุฑ

### ุงููุณุชุญูุงุช vs ุงููุฏููุนุงุช
- **ุงููุณุชุญูุงุช**: ูุจูุนุงุช + ุฑุณูู (ุฏูู ุนูู ุงููุชุฌุฑ)
- **ุงููุฏููุนุงุช**: ูุง ุฏูุนู ุงููุชุฌุฑ ูุนููุงู
- **ุงููุฑู**: ุงูุฑุตูุฏ ุงูุญุงูู

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

