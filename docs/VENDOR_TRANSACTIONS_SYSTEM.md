# ูุธุงู ูุนุงููุงุช ุงููุชุฌุฑ - Vendor Transactions System

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุงูู ูุชุชุจุน ุงููุนุงููุงุช ุงููุงููุฉ ุจูู ุงููุชุฌุฑ (POS Vendor) ูุงูุดุจูุฉ (Network Owner).

---

## ๐ ุฃููุงุน ุงููุนุงููุงุช

### **1. ูุฏูู (Charge) - ุทูุจ ูุฑูุช:**
```
ุงููุชุฌุฑ ูุทูุจ ูุฑูุช โ ุงูุดุจูุฉ ุชูุงูู
โโ ููุดุฆ ูุนุงููุฉ "ูุฏูู"
โโ ุงููุจูุบ: ููุฌุจ
โโ ูุฒูุฏ ุงูุฏูู ุนูู ุงููุชุฌุฑ
โโ ูุธูุฑ ุจุงูููู ุงูุฃุญูุฑ ๐ด
```

### **2. ุฏุงุฆู (Payment) - ุฏูุนุฉ ููุฏูุฉ:**
```
ุงูุดุจูุฉ ุชุทูุจ ุชุฃููุฏ ุฏูุนุฉ โ ุงููุชุฌุฑ ููุงูู
โโ ููุดุฆ ูุนุงููุฉ "ุฏุงุฆู"
โโ ุงููุจูุบ: ููุฌุจ (type ูุญุฏุฏ ุงูุงุชุฌุงู)
โโ ูููู ุงูุฏูู ุนูู ุงููุชุฌุฑ
โโ ูุธูุฑ ุจุงูููู ุงูุฃุฎุถุฑ ๐ข
```

---

## ๐ฑ ุงููุงุฌูุฉ

### **ุตูุญุฉ ุชูุงุตูู ุงูุดุจูุฉ โ ุชุงุจ ุงููุนุงููุงุช:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุชูุงุตูู ุงูุดุจูุฉ                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุงูุจุงูุงุช  |  ุงููุนุงููุงุช             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ     ุงูุฑุตูุฏ ุงูุญุงูู             โ โ
โ  โ     220,000 ุฑ.ู               โ โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ โ
โ  โ ุฅุฌูุงูู ุงูุดุญู  โ  ุฅุฌูุงูู ุงูุฏูุนโ โ
โ  โ  220,000 ุฑ.ู  โ    0 ุฑ.ู      โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ๐ด ูุฏูู          220,000 ุฑ.ู โ โ  โ ุทูุจ ูุฑูุช
โ  โ    ููุฐ 5 ุฏูุงุฆู              โ โ
โ  โ    ุทูุจ ูุฑูุช - 2 ุจุงูุฉ - 75 ูุฑุชโ โ
โ  โ    โ ููุชูู                  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ๐ข ุฏุงุฆู          100,000 ุฑ.ู โ โ  โ ุฏูุนุฉ ููุฏูุฉ
โ  โ    ููุฐ ุณุงุนุฉ                 โ โ
โ  โ    ุฏูุนุฉ ููุฏูุฉ                โ โ
โ  โ    โ ููุชูู                  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### **VendorTransactionModel:**

```dart
class VendorTransactionModel {
  final String id;
  final String vendorId;
  final String networkId;
  final String type;          // charge (ูุฏูู) ุฃู payment (ุฏุงุฆู)
  final double amount;        // ููุฌุจ ุฏุงุฆูุงู
  final String description;
  final String status;        // pending, completed, rejected
  final DateTime date;
  final String? orderId;      // ุฑุจุท ุจุทูุจ ุงููุฑูุช
  final String? paymentRequestId;  // ุฑุจุท ุจุทูุจ ุงูุฏูุน
  
  // helpers
  bool get isDebit => type == 'charge';
  bool get isCredit => type == 'payment';
}
```

### **ูู Firebase - transactions:**

#### **ูุนุงููุฉ ุทูุจ ูุฑูุช (ูุฏูู):**
```json
{
  "id": "trans_001",
  "vendorId": "vendor_123",
  "vendorName": "ูุชุฌุฑ ุงูุฃูู",
  "networkId": "network_456",
  "networkName": "ุดุจูุฉ ุงูููุฑ",
  "type": "charge",              โญ ูุฏูู
  "amount": 220000,              โญ ููุฌุจ
  "description": "ุทูุจ ูุฑูุช - 2 ุจุงูุฉ - 75 ูุฑุช",
  "status": "completed",
  "orderId": "order_001",
  "date": "2025-10-26T11:00:00Z"
}
```

#### **ูุนุงููุฉ ุฏูุนุฉ ููุฏูุฉ (ุฏุงุฆู):**
```json
{
  "id": "trans_002",
  "vendorId": "vendor_123",
  "networkId": "network_456",
  "type": "payment",             โญ ุฏุงุฆู
  "amount": 100000,              โญ ููุฌุจ (type ูุญุฏุฏ ุงูุงุชุฌุงู)
  "description": "ุฏูุนุฉ ููุฏูุฉ",
  "status": "completed",
  "reference": "PAY-pay_req_001",
  "date": "2025-10-26T12:00:00Z"
}
```

---

## ๐ ุณูุฑ ุงูุนูู

### **1. ุทูุจ ูุฑูุช (ูุฏูู):**

```
1. ุงููุชุฌุฑ ูุฑุณู ุทูุจ
   โโ ูุฎุชุงุฑ ุจุงูุงุช
   โโ ูุญุฏุฏ ุงููููุงุช

2. ุงูุดุจูุฉ ุชูุงูู ุนูู ุงูุทูุจ
   โโ ูููู ุงููุฑูุช
   โโ ููุดุฆ ูุนุงููุฉ: โ
      โโ type: "charge"
      โโ amount: 220000
      โโ description: "ุทูุจ ูุฑูุช - 2 ุจุงูุฉ - 75 ูุฑุช"

3. ุงููุชุฌุฑ ูุฑู ูู ุชุงุจ ุงููุนุงููุงุช:
   โโ ๐ด ูุฏูู: 220,000 ุฑ.ู
   โโ ุงูุฑุตูุฏ: -220,000 ุฑ.ู (ุฏูู)
   โโ ุฅุฌูุงูู ุงูุดุญู: 220,000 ุฑ.ู
```

### **2. ุฏูุนุฉ ููุฏูุฉ (ุฏุงุฆู):**

```
1. ุงูุดุจูุฉ ุชุฑุณู ุทูุจ ุชุฃููุฏ ุฏูุนุฉ
   โโ ุงููุจูุบ: 100,000 ุฑ.ู
   โโ ููุดุฆ ูุนุงููุฉ ูุนููุฉ (pending)

2. ุงููุชุฌุฑ ููุงูู
   โโ ุชุญุฏูุซ ุงููุนุงููุฉ โ completed
   โโ ุงูุญุงูุฉ: ููุชูู โ

3. ุงููุชุฌุฑ ูุฑู ูู ุชุงุจ ุงููุนุงููุงุช:
   โโ ๐ข ุฏุงุฆู: 100,000 ุฑ.ู
   โโ ุงูุฑุตูุฏ: -120,000 ุฑ.ู (ุชููุต ุงูุฏูู)
   โโ ุฅุฌูุงูู ุงูุฏูุน: 100,000 ุฑ.ู
```

---

## ๐ ุญุณุงุจ ุงูุฑุตูุฏ

### **ุงููุนุงุฏูุฉ:**
```
ุงูุฑุตูุฏ = ุฅุฌูุงูู ุงูุดุญู - ุฅุฌูุงูู ุงูุฏูุน

ูุซุงู:
โโ ุฅุฌูุงูู ุงูุดุญู: 220,000 ุฑ.ู (ุทูุจุงุช ูุฑูุช)
โโ ุฅุฌูุงูู ุงูุฏูุน: 100,000 ุฑ.ู (ุฏูุนุงุช ููุฏูุฉ)
โโ ุงูุฑุตูุฏ: 120,000 ุฑ.ู (ุฏูู ุนูู ุงููุชุฌุฑ)
```

---

## ๐ฏ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ

### **ูู firebase_order_service.dart:**

```dart
// ุนูุฏ ุงูููุงููุฉ ุนูู ุงูุทูุจ
transaction.set(transactionRef, {
  'vendorId': order.vendorId,
  'networkId': order.networkId,
  'type': 'charge',                    // ูุฏูู
  'amount': order.totalAmount,         // 220,000
  'description': 'ุทูุจ ูุฑูุช - 2 ุจุงูุฉ - 75 ูุฑุช',
  'status': 'completed',
  'orderId': order.id,
  'date': FieldValue.serverTimestamp(),
});
```

### **ูู firebase_payment_service.dart:**

```dart
// ุนูุฏ ุฅุฑุณุงู ุทูุจ ุฏูุนุฉ
final transaction = TransactionModel(
  type: 'payment',        // ุฏุงุฆู
  amount: amount,         // 100,000 (ููุฌุจ)
  status: 'pending',      // ูุนูู
  reference: 'PAY-$paymentRequestId',
);

// ุนูุฏ ุงูููุงููุฉ ุนูู ุงูุฏูุนุฉ
transaction.update({
  'status': 'completed',  // ููุชูู
  'notes': 'ุชูุช ุงูููุงููุฉ',
});
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **ุงูุฎุทูุฉ 1: ุฅุฑุณุงู ุทูุจ ูุฑูุช**

```
ูู ุญุณุงุจ ุงููุชุฌุฑ:
1. ุงุฐูุจ ูุชูุงุตูู ุงูุดุจูุฉ
2. ุงุถุบุท "ุฅุฑุณุงู ุทูุจ"
3. ุงุฎุชุฑ ุจุงูุงุช (ูุซูุงู: 2 ุจุงูุฉุ 75 ูุฑุช)
4. ุฃุฑุณู ุงูุทูุจ
```

### **ุงูุฎุทูุฉ 2: ุงูููุงููุฉ ุนูู ุงูุทูุจ**

```
ูู ุญุณุงุจ ุงูุดุจูุฉ:
1. ุชุงุจ ุงูุทูุจุงุช
2. ุงุถุบุท "ููุงููุฉ"
3. โ ุชูุช ุงูููุงููุฉ ูุชู ููู ุงููุฑูุช
```

### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงููุนุงููุงุช**

```
ูู ุญุณุงุจ ุงููุชุฌุฑ:
1. ุงุฐูุจ ูุชูุงุตูู ุงูุดุจูุฉ
2. ุชุงุจ "ุงููุนุงููุงุช"
3. โ ูุฌุจ ุฃู ุชุฑู:
   โโ ุงูุฑุตูุฏ ุงูุญุงูู: 220,000 ุฑ.ู
   โโ ุฅุฌูุงูู ุงูุดุญู: 220,000 ุฑ.ู
   โโ ุฅุฌูุงูู ุงูุฏูุน: 0 ุฑ.ู
   โโ ูุนุงููุฉ:
      โโ ๐ด ูุฏูู: 220,000 ุฑ.ู
      โโ ุทูุจ ูุฑูุช - 2 ุจุงูุฉ - 75 ูุฑุช
      โโ โ ููุชูู
```

### **ุงูุฎุทูุฉ 4: ุฅุฑุณุงู ุฏูุนุฉ ููุฏูุฉ**

```
ูู ุญุณุงุจ ุงูุดุจูุฉ:
1. ุตูุญุฉ ุงููุชุงุฌุฑ โ "ูุชุฌุฑ ุงูุฃูู"
2. ุฃู ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ "ุฏูุนุฉ ููุฏูุฉ"
3. ุงุฎุชุฑ ุงููุชุฌุฑ
4. ุฃุฏุฎู ุงููุจูุบ: 100,000 ุฑ.ู
5. ุงุถุบุท "ุฅุฑุณุงู"
6. โ ุชู ุฅุฑุณุงู ุทูุจ ุงูุฏูุนุฉ
```

### **ุงูุฎุทูุฉ 5: ุงููุชุฌุฑ ููุงูู (ุฅุฐุง ูุงู ููุงู ูุธุงู ููุงููุฉ)**

```
ุงููุนุงููุฉ ุชููุดุฃ ุชููุงุฆูุงู ูู completed
(ุฃู pending ุฅุฐุง ูุงู ูุชุทูุจ ููุงููุฉ ุงููุชุฌุฑ)
```

### **ุงูุฎุทูุฉ 6: ุงูุชุญูู ุงูููุงุฆู**

```
ูู ุญุณุงุจ ุงููุชุฌุฑ:
1. ุชูุงุตูู ุงูุดุจูุฉ โ ุชุงุจ ุงููุนุงููุงุช
2. โ ูุฌุจ ุฃู ุชุฑู:
   โโ ุงูุฑุตูุฏ ุงูุญุงูู: 120,000 ุฑ.ู
   โโ ุฅุฌูุงูู ุงูุดุญู: 220,000 ุฑ.ู
   โโ ุฅุฌูุงูู ุงูุฏูุน: 100,000 ุฑ.ู
   โโ ูุนุงููุชูู:
      โโ ๐ด ูุฏูู: 220,000 ุฑ.ู
      โโ ๐ข ุฏุงุฆู: 100,000 ุฑ.ู
```

---

## ๐ ุงูููุฎุต ุงููุงูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     ุงูุฑุตูุฏ ุงูุญุงูู              โ
โ     120,000 ุฑ.ู                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุฅุฌูุงูู ุงูุดุญู โ  ุฅุฌูุงูู ุงูุฏูุน  โ
โ  220,000 ุฑ.ู โ   100,000 ุฑ.ู   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุฑุตูุฏ = 220,000 - 100,000 = 120,000 ุฑ.ู
```

---

## ๐จ ุงูุชุตููู

### **ุจุทุงูุฉ ูุนุงููุฉ (ูุฏูู):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ด  ูุฏูู  [ููุชูู]  220,000 ุฑ.ูโ
โ     ุทูุจ ูุฑูุช - 2 ุจุงูุฉ - 75 ูุฑุชโ
โ     ููุฐ 5 ุฏูุงุฆู                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### **ุจุทุงูุฉ ูุนุงููุฉ (ุฏุงุฆู):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ข  ุฏุงุฆู  [ููุชูู]  100,000 ุฑ.ูโ
โ     ุฏูุนุฉ ููุฏูุฉ                โ
โ     ููุฐ ุณุงุนุฉ                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ ุงููููุงุช ุงูููุดุฃุฉ

```
โจ Models:
   - vendor_transaction_model.dart

โจ Services:
   - firebase_vendor_transaction_service.dart
   - firebase_payment_service.dart (ูุญุฏุซ)

โจ Pages:
   - network_details_page.dart (ูุญุฏุซ - ุชุงุจ ุงููุนุงููุงุช)

โจ Widgets:
   - _TransactionCard (ูู network_details_page)

โ๏ธ ูุญุฏุซ:
   - firebase_order_service.dart (ุชุณุฌูู ูุนุงููุฉ ุนูุฏ ุงูููุงููุฉ)
   - firestore.indexes.json (ููุงุฑุณ ุงููุนุงููุงุช)
```

---

## ๐ฅ Firestore Indexes

```json
[
  {
    "collectionGroup": "transactions",
    "fields": [
      {"fieldPath": "vendorId", "order": "ASCENDING"},
      {"fieldPath": "networkId", "order": "ASCENDING"},
      {"fieldPath": "date", "order": "DESCENDING"}
    ]
  },
  {
    "collectionGroup": "transactions",
    "fields": [
      {"fieldPath": "vendorId", "order": "ASCENDING"},
      {"fieldPath": "networkId", "order": "ASCENDING"},
      {"fieldPath": "reference", "order": "ASCENDING"}
    ]
  }
]
```

---

## ๐ ุงููุชูุฌุฉ

### **ูุจู:**
```
โ ูุง ููุฌุฏ ุชุชุจุน ูููุนุงููุงุช ูู ุญุณุงุจ ุงููุชุฌุฑ
โ ูุง ูุนุฑู ุงููุชุฌุฑ ุฑุตูุฏู ูุน ุงูุดุจูุฉ
โ ูุง ูุนูููุงุช ุนู ุงูุฏูุนุงุช
```

### **ุจุนุฏ:**
```
โ ุชุณุฌูู ุชููุงุฆู ูุฌููุน ุงููุนุงููุงุช
โ ุฑุตูุฏ ูุงุถุญ ููุญุฏุซ
โ ุฅุฌูุงูู ุงูุดุญู ูุงูุฏูุน
โ ุชูุงุตูู ูู ูุนุงููุฉ
โ ุชุญุฏูุซ ููุฑู (real-time)
โ ูุงุฌูุฉ ุงุญุชุฑุงููุฉ
```

---

## ๐ก ุงูููุงุฆุฏ

### **ูููุชุฌุฑ:**
- โ **ูุนุฑูุฉ ุงูุฑุตูุฏ** ูุน ูู ุดุจูุฉ
- โ **ุชุชุจุน ุงูุทูุจุงุช** ูุงูุฏูุนุงุช
- โ **ุดูุงููุฉ ูุงููุฉ** ูุงููุฉ
- โ **ุณูููุฉ ุงููุฑุงุฌุนุฉ**

### **ููุดุจูุฉ:**
- โ **ุชุณุฌูู ุชููุงุฆู** ูุฌููุน ุงูุนูููุงุช
- โ **ุญุณุงุจ ุฏููู** ูููุณุชุญูุงุช
- โ **ูุง ุญุงุฌุฉ ูุชุณุฌูู ูุฏูู**

### **ูููุธุงู:**
- โ **ุณูุงูุฉ ุงูุจูุงูุงุช** (Firebase Transactions)
- โ **ุชุฒุงูู ุชุงู** ุจูู ุงูุทุฑููู
- โ **ูุง ุชูุงูุถุงุช**

---

**๐ ุงููุธุงู ุงููุงูู ูุชูุงูู ุชูุงูุงู!** โจ

ุงููุชุฌุฑ ุงูุขู ูุฑู:
โ ุฌููุน ูุนุงููุงุชู ูุน ูู ุดุจูุฉ  
โ ุงูุฑุตูุฏ ุงูุญุงูู  
โ ุฅุฌูุงูู ุงููุดุชุฑูุงุช ูุงูุฏูุนุงุช  
โ ุชูุงุตูู ูู ุนูููุฉ  

**๐ ูุธุงู ูุญุงุณุจู ุงุญุชุฑุงูู!** ๐

