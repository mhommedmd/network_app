# ูุธุงู ุงูุทูุจุงุช ุงููุชูุงูู - Orders System

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุฑูุช ุจูู ุงููุชุงุฌุฑ (POS Vendor) ูุงูุดุจูุงุช (Network Owner).

---

## ๐ ุขููุฉ ุงูุนูู ุงููุงููุฉ

```
ุงููุชุฌุฑ โ ุฅุฑุณุงู ุทูุจ โ ุงูุดุจูุฉ โ ููุงููุฉ โ ููู ุงููุฑูุช
```

### **ุณูุฑ ุงูุนูู ุฎุทูุฉ ุจุฎุทูุฉ:**

```
1. ุงููุชุฌุฑ (POS Vendor):
   โโ ูุฎุชุงุฑ ุดุจูุฉ ูู ูุงุฆูุฉ ุงูุดุจูุงุช ุงููุถุงูุฉ
   โโ ููุชุญ ุชูุงุตูู ุงูุดุจูุฉ
   โโ ูุถุบุท ุนูู "ุฅุฑุณุงู ุทูุจ"
   โโ ูููุฃ ูููุฐุฌ ุงูุทูุจ:
      โโ ุงุฎุชูุงุฑ ุงูุจุงูุฉ
      โโ ุชุญุฏูุฏ ุงููููุฉ
      โโ ูุฑุงุฌุนุฉ ุงููุฌููุน

2. ุฅุฑุณุงู ุงูุทูุจ:
   โโ ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ ูู ูุฎุฒูู ุงูุดุจูุฉ
   โโ ุญูุธ ุงูุทูุจ ูู Firebase (status: pending)
   โโ ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ

3. ุงูุดุจูุฉ (Network Owner):
   โโ ุชุณุชูุจู ุงูุทูุจ ูู ุชุงุจ "ุงูุทูุจุงุช"
   โโ ุชุฑู ุชูุงุตูู ุงูุทูุจ:
   โ  โโ ุงุณู ุงููุชุฌุฑ
   โ  โโ ุงูุจุงูุฉ ุงููุทููุจุฉ
   โ  โโ ุงููููุฉ
   โ  โโ ุงููุจูุบ ุงูุฅุฌูุงูู
   โโ ุชุฎุชุงุฑ (ููุงููุฉ ุฃู ุฑูุถ)

4. ุนูุฏ ุงูููุงููุฉ:
   โโ ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ
   โโ ููู ุงููุฑูุช ูู cards โ vendor_cards
   โโ ุชุญุฏูุซ ุญุงูุฉ ุงููุฑูุช ูู ูุฎุฒูู ุงูุดุจูุฉ (transferred)
   โโ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ (approved)
   โโ ุฅุธูุงุฑ ุฑุณุงูุฉ ูุฌุงุญ

5. ุนูุฏ ุงูุฑูุถ:
   โโ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ (rejected)
   โโ ุฅุถุงูุฉ ููุงุญุธุฉ (ุงุฎุชูุงุฑู)

6. ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
   โโ ุงููุชุฌุฑ: ูุฑู ุงููุฑูุช ูู ูุฎุฒููู
   โโ ุงูุดุจูุฉ: ูุชูุงูุต ูุฎุฒูููุง ุจุงููููุฉ ุงููููููุฉ
```

---

## ๐๏ธ ุงููููู ุงูููู

### **1. ุงูููุงุฐุฌ (Models):**

#### **OrderModel:**
```dart
class OrderModel {
  final String id;
  final String vendorId;          // ูุนุฑู ุงููุชุฌุฑ
  final String vendorName;
  final String networkId;         // ูุนุฑู ุงูุดุจูุฉ
  final String networkName;
  final String packageId;         // ูุนุฑู ุงูุจุงูุฉ
  final String packageName;
  final int quantity;             // ุงููููุฉ ุงููุทููุจุฉ
  final double pricePerCard;      // ุณุนุฑ ุงููุฑุช ุงููุงุญุฏ
  final double totalAmount;       // ุงููุฌููุน ุงูููู
  final String status;            // pending, approved, rejected
  final DateTime createdAt;
  final DateTime? approvedAt;
  final DateTime? rejectedAt;
  final String? notes;
}
```

### **2. ุงูุฎุฏูุงุช (Services):**

#### **FirebaseOrderService:**

```dart
// ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
static Future<String> createOrder(OrderModel order)

// ุงูุญุตูู ุนูู ุทูุจุงุช ุงูุดุจูุฉ
static Stream<List<OrderModel>> getNetworkOrders(String networkId)

// ุงูุญุตูู ุนูู ุทูุจุงุช ุงููุชุฌุฑ
static Stream<List<OrderModel>> getVendorOrders(String vendorId)

// ุงูููุงููุฉ ุนูู ุงูุทูุจ ูููู ุงููุฑูุช
static Future<void> approveOrder(OrderModel order)

// ุฑูุถ ุงูุทูุจ
static Future<void> rejectOrder(String orderId, {String? notes})

// ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ
static Future<bool> checkStockAvailability({
  required String networkId,
  required String packageId,
  required int quantity,
})
```

---

## ๐ฑ ุงููุงุฌูุงุช

### **1. ุตูุญุฉ ุฅุฑุณุงู ุงูุทูุจ (POS Vendor):**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  ุฅุฑุณุงู ุทูุจ ุฌุฏูุฏ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                    โ
โ  ๐ข ุงูุดุจูุฉ: ุดุจูุฉ ุงูููุฑ            โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  ุงุฎุชุฑ ุงูุจุงูุฉ:                     โ
โ                                    โ
โ  โช ุจุงูุฉ ููููุฉ ุงูุชุตุงุฏูุฉ           โ
โ     ุงูุณุนุฑ: 800 ุฑ.ู โข ูุชููุฑ: 100   โ
โ                                    โ
โ  โซ ุจุงูุฉ ุฃุณุจูุนูุฉ                  โ
โ     ุงูุณุนุฑ: 4,000 ุฑ.ู โข ูุชููุฑ: 50  โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  ุงููููุฉ ุงููุทููุจุฉ:                 โ
โ                                    โ
โ       โ     25     โ              โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  ๐ ููุฎุต ุงูุทูุจ                    โ
โ  ุงูุจุงูุฉ: ุจุงูุฉ ุฃุณุจูุนูุฉ            โ
โ  ุงููููุฉ: 25 ูุฑุช                   โ
โ  ุงูุณุนุฑ ูููุฑุช: 4,000 ุฑ.ู           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  ุงููุฌููุน: 100,000 ุฑ.ู             โ
โ                                    โ
โ       [๐ค ุฅุฑุณุงู ุงูุทูุจ]             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### **2. ุตูุญุฉ ุงูุทูุจุงุช (Network Owner):**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            ุงูุทูุจุงุช                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [ุงููู] [ููุฏ ุงูุงูุชุธุงุฑ] [ููุงูู] [ูุฑููุถ]
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ๐ช ูุชุฌุฑ ุงูุฃูู               โ๐กโ
โ  โ    ููุฐ 30 ุฏูููุฉ              โ  โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ ๐ฆ ุงูุจุงูุฉ: ุจุงูุฉ ููููุฉ       โ  โ
โ  โ ๐ซ ุงููููุฉ: 50 ูุฑุช            โ  โ
โ  โ ๐ฐ ุณุนุฑ ุงููุฑุช: 800 ุฑ.ู        โ  โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ ุงููุฌููุน: 40,000 ุฑ.ู          โ  โ
โ  โ                              โ  โ
โ  โ    [โ ุฑูุถ]    [โ ููุงููุฉ]     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ๐ช ูุชุฌุฑ ุงูุชูููุฑ             โ๐ขโ
โ  โ    ููุฐ ุณุงุนุชูู                โ  โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ
โ  โ ุชูุช ุงูููุงููุฉ                 โ  โ
โ  โ ุงููุฌููุน: 120,000 ุฑ.ู         โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฅ Collections ูู Firebase

### **1. orders:**
```json
{
  "id": "order_001",
  "vendorId": "vendor_123",
  "vendorName": "ูุชุฌุฑ ุงูุฃูู",
  "networkId": "network_456",
  "networkName": "ุดุจูุฉ ุงูููุฑ",
  "packageId": "pkg_789",
  "packageName": "ุจุงูุฉ ููููุฉ ุงูุชุตุงุฏูุฉ",
  "quantity": 50,
  "pricePerCard": 800,
  "totalAmount": 40000,
  "status": "pending",
  "createdAt": "2025-10-26T10:30:00Z"
}
```

### **2. vendor_cards (ุจุนุฏ ุงูููุงููุฉ):**
```json
{
  "id": "vcard_001",
  "vendorId": "vendor_123",
  "vendorName": "ูุชุฌุฑ ุงูุฃูู",
  "networkId": "network_456",
  "networkName": "ุดุจูุฉ ุงูููุฑ",
  "packageId": "pkg_789",
  "packageName": "ุจุงูุฉ ููููุฉ ุงูุชุตุงุฏูุฉ",
  "cardNumber": "1234-5678-9012",
  "status": "available",
  "price": 800,
  "orderId": "order_001",
  "transferredAt": "2025-10-26T11:00:00Z",
  "createdAt": "2025-10-26T11:00:00Z"
}
```

### **3. cards (ุจุนุฏ ุงูููู):**
```json
{
  "id": "card_001",
  "networkId": "network_456",
  "packageId": "pkg_789",
  "cardNumber": "1234-5678-9012",
  "status": "transferred",  โ ุชู ุชุญุฏูุซูุง
  "transferredTo": "vendor_123",
  "transferredAt": "2025-10-26T11:00:00Z",
  "orderId": "order_001"
}
```

---

## ๐ Firestore Rules

```javascript
// ููุงุนุฏ ุงูุทูุจุงุช
match /orders/{orderId} {
  // ุงููุฑุงุกุฉ ููุดุจูุฉ ูุงููุชุฌุฑ ุงููุฑุชุจุทูู
  allow read: if isAuthenticated() && 
                 (resource.data.networkId == request.auth.uid ||
                  resource.data.vendorId == request.auth.uid);
  
  // ุงูุฅูุดุงุก ูููุชุฌุฑ ููุท
  allow create: if isAuthenticated() && 
                   request.resource.data.vendorId == request.auth.uid;
  
  // ุงูุชุญุฏูุซ ููุดุจูุฉ ููุท (ููููุงููุฉ/ุงูุฑูุถ)
  allow update: if isAuthenticated() && 
                   resource.data.networkId == request.auth.uid;
  
  // ุงูุญุฐู ูููุชุฌุฑ ูุงูุดุจูุฉ
  allow delete: if isAuthenticated() && 
                   (resource.data.networkId == request.auth.uid ||
                    resource.data.vendorId == request.auth.uid);
}
```

---

## ๐ Firestore Indexes

```json
{
  "collectionGroup": "orders",
  "fields": [
    {"fieldPath": "networkId", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
},
{
  "collectionGroup": "orders",
  "fields": [
    {"fieldPath": "vendorId", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
},
{
  "collectionGroup": "vendor_cards",
  "fields": [
    {"fieldPath": "vendorId", "order": "ASCENDING"},
    {"fieldPath": "networkId", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"}
  ]
}
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **1. ูู ุฌุงูุจ ุงููุชุฌุฑ:**

```
1. ุงูุชุญ ุงูุชุทุจูู ูู POS Vendor
2. ุงุฐูุจ ูุตูุญุฉ "ุงูุดุจูุงุช"
3. ุงุถุบุท ุนูู ุดุจูุฉ
4. ุงุถุบุท "ุฅุฑุณุงู ุทูุจ" (ุงูุฒุฑ ุงูุนุงุฆู)
5. ุงุฎุชุฑ ุจุงูุฉ
6. ุญุฏุฏ ุงููููุฉ (ูุซูุงู: 25)
7. ุงุถุบุท "ุฅุฑุณุงู ุงูุทูุจ"
8. โ ูุฌุจ ุฃู ุชุฑู "ุชู ุฅุฑุณุงู ุงูุทูุจ ุจูุฌุงุญ"
```

### **2. ูู ุฌุงูุจ ุงูุดุจูุฉ:**

```
1. ุงูุชุญ ุงูุชุทุจูู ูู Network Owner
2. ุงุฐูุจ ูุตูุญุฉ "ุงูุดุจูุฉ" โ ุชุงุจ "ุงูุทูุจุงุช"
3. ูุฌุจ ุฃู ุชุฑู ุงูุทูุจ ุงูุฌุฏูุฏ
4. ุงุถุบุท "ููุงููุฉ"
5. ุงุถุบุท "ุชุฃููุฏ" ูู ุงูุญูุงุฑ
6. โ ูุฌุจ ุฃู ุชุฑู "ุชูุช ุงูููุงููุฉ ูุชู ููู ุงููุฑูุช"
7. ุชุญูู ูู ุงููุฎุฒูู (ูุฌุจ ุฃู ูุชูุงูุต)
```

### **3. ูู ุฌุงูุจ ุงููุชุฌุฑ (ุจุนุฏ ุงูููุงููุฉ):**

```
1. ุงุฑุฌุน ูุญุณุงุจ POS Vendor
2. ุงุฐูุจ ูุตูุญุฉ ุชูุงุตูู ุงูุดุจูุฉ
3. ูู ุชุงุจ "ุงูุจุงูุงุช"
4. โ ูุฌุจ ุฃู ุชุฑู ุงููุฎุฒูู ูุฏ ุฒุงุฏ ุจุงููููุฉ ุงููุทููุจุฉ
```

---

## ๐ก ููุฒุงุช ุงููุธุงู

### โ **ูููุชุฌุฑ (POS Vendor):**
- ุฅุฑุณุงู ุทูุจุงุช ุฌุฏูุฏุฉ
- ุงุฎุชูุงุฑ ุงูุจุงูุฉ ูุงููููุฉ
- ุฑุคูุฉ ุงูุณุนุฑ ูุงููุฌููุน
- ุงูุชุญูู ูู ุงูุชููุฑ ูุจู ุงูุฅุฑุณุงู
- ุฑุคูุฉ ุญุงูุฉ ุงูุทูุจุงุช

### โ **ููุดุจูุฉ (Network Owner):**
- ุงุณุชูุจุงู ุงูุทูุจุงุช real-time
- ููุชุฑุฉ ุญุณุจ ุงูุญุงูุฉ (ุงูููุ ููุฏ ุงูุงูุชุธุงุฑุ ููุงููุ ูุฑููุถ)
- ุงูููุงููุฉ/ุงูุฑูุถ ูุน ุชุฃููุฏ
- ููู ุชููุงุฆู ูููุฑูุช ุนูุฏ ุงูููุงููุฉ
- ุชุญุฏูุซ ุชููุงุฆู ูููุฎุฒูู

### โ **ุงููุธุงู:**
- ูุนุงููุงุช Firebase Transactions ูุถูุงู ุณูุงูุฉ ุงูุจูุงูุงุช
- ุงูุชุญูู ูู ุชููุฑ ุงููููุฉ
- ููู ุขูู ูููุฑูุช
- ุชุญุฏูุซ ุญุงูุงุช ุงูุทูุจุงุช
- Real-time updates

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ

```
โจ Models:
   - order_model.dart

โจ Services:
   - firebase_order_service.dart

โจ Pages:
   - send_order_page.dart (POS Vendor)

โจ Widgets:
   - order_card.dart (Network Owner)

โ๏ธ ูุญุฏุซ:
   - network_details_page.dart (ุฒุฑ ุฅุฑุณุงู ุทูุจ)
   - network_page.dart (ุชุงุจ ุงูุทูุจุงุช)
   - firestore.rules (ููุงุนุฏ orders)
   - firestore.indexes.json (ููุงุฑุณ orders)
```

---

## ๐ ุงููุชูุฌุฉ

### **ูุจู:**
```
โ ูุง ููุฌุฏ ูุธุงู ููุทูุจุงุช
โ ูุง ุทุฑููุฉ ูููู ุงููุฑูุช
โ ุจูุงูุงุช ููููุฉ
```

### **ุจุนุฏ:**
```
โ ูุธุงู ุทูุจุงุช ูุชูุงูู
โ ููู ุชููุงุฆู ูููุฑูุช
โ ูุนุงููุงุช ุขููุฉ
โ ุชุญุฏูุซ ููุฑู
โ ูุงุฌูุงุช ุงุญุชุฑุงููุฉ
โ ุฌุงูุฒ ููุฅูุชุงุฌ
```

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุชูุงูู ุชูุงูุงู!**

ุงููุชุฌุฑ ููููู ุงูุขู:
โ ุฅุฑุณุงู ุทูุจุงุช ููุดุจูุงุช  
โ ุชุญุฏูุฏ ุงูุจุงูุฉ ูุงููููุฉ  
โ ุฑุคูุฉ ุงููุฌููุน ูุจู ุงูุฅุฑุณุงู  

ุงูุดุจูุฉ ูููููุง ุงูุขู:
โ ุงุณุชูุจุงู ุงูุทูุจุงุช  
โ ุงูููุงููุฉ ุฃู ุงูุฑูุถ  
โ **ููู ุงููุฑูุช ุชููุงุฆูุงู** โญ  

**๐ ุงููุธุงู ูุนูู ุจููุงุกุฉ ุนุงููุฉ!** โจ

