# โ ุฅุถุงูุฉ ุฎุงุตูุฉ ุญุฐู ุงููุชุงุฌุฑ + ุฅุตูุงุญ ูุดููุฉ ุงููุนุงููุงุช

## ๐ฏ ุงูุชุญุฏูุซุงุช

### 1. ุฅุถุงูุฉ ุฒุฑ ุญุฐู ุงููุชุฌุฑ ๐๏ธ
ุชู ุฅุถุงูุฉ ุฃููููุฉ ุญุฐู ูู ุฃุนูู ูุณุงุฑ ูู ุจุทุงูุฉ ูุชุฌุฑ ูู ุตูุญุฉ "ุงููุชุงุฌุฑ".

**ุงูููุฒุงุช:**
- โ ุฃููููุฉ ุญูุฑุงุก ูุงุถุญุฉ
- โ ูุงูุฐุฉ ุชุฃููุฏ ูุจู ุงูุญุฐู
- โ ุชุญุฐูุฑ ูู ุญุฐู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ
- โ ุฑุณุงูุฉ ูุฌุงุญ/ูุดู

---

### 2. ุฅุตูุงุญ ูุดููุฉ ุงููุนุงููุงุช โ

**ุงููุดููุฉ:**
```
vendors collection:
  - Document ID: mublIzl2wAFXS5KfeyIx  (ุนุดูุงุฆู)
  - User ID: I1Xk9X7a32PW5apyAJ3zpaZryOc2

transactions collection:
  - vendorId: I1Xk9X7a32PW5apyAJ3zpaZryOc2  (user ID)

ุงููุชูุฌุฉ: ูุง ุชุธูุฑ ุงููุนุงููุงุช! โ
```

**ุงูุญู:**
```
vendors collection:
  - Document ID: I1Xk9X7a32PW5apyAJ3zpaZryOc2  (ููุณ user ID!)

transactions collection:
  - vendorId: I1Xk9X7a32PW5apyAJ3zpaZryOc2

ุงููุชูุฌุฉ: ุงููุนุงููุงุช ุชุธูุฑ! โ
```

---

## ๐ง ุงูุชุนุฏููุงุช ุงูุชู ุชูุช

### 1. `firebase_vendor_service.dart`
```dart
// ูุจู
final docRef = await _firestore.collection('vendors').add(vendorData);
return docRef.id;  // โ ID ุนุดูุงุฆู

// ุจุนุฏ
await _firestore.collection('vendors').doc(vendor.id).set(vendorData);
return vendor.id;  // โ user ID
```

### 2. `vendor_search_page.dart`
```dart
// ูุจู
id: '', // โ ูุงุฑุบ

// ุจุนุฏ
id: vendor.id, // โ user ID ูู users collection
```

### 3. `accounts_page.dart`
- โ ุฅุถุงูุฉ `_handleDeleteVendor` method
- โ ุฅุถุงูุฉ `onDelete` parameter ูู `_VendorTile`
- โ ุฅุถุงูุฉ ุฒุฑ ุงูุญุฐู ูู `Stack`

### 4. `firebase_order_service.dart`
- โ ุฅุถุงูุฉ ุฌููุน ุงูุญููู ุงููุทููุจุฉ ูููุนุงููุงุช (`reference`, `balanceAfter`, `createdBy`, `method`)

### 5. `firebase_payment_service.dart`
- โ ุฅุถุงูุฉ ุฌููุน ุงูุญููู ุงููุทููุจุฉ ูููุนุงููุงุช

### 6. `firebase_transaction_service.dart`
- โ ุฅุถุงูุฉ ุชุตููุฉ ุจู `status: 'completed'`
- โ ุฑุณุงุฆู ุชุดุฎูุต

### 7. `firestore.rules`
- โ ุชุบููุฑ ูู `networkId == auth.uid` ุฅูู `createdBy == auth.uid`

### 8. `firestore.indexes.json`
- โ ุฅุถุงูุฉ ููุฑุณ: `vendorId + networkId + status + date DESC`

---

## ๐ ุฎุทูุงุช ุงูุฅุตูุงุญ ุงููุงูู

### ุงูุฎุทูุฉ 1: ุญุฐู ุงููุชุงุฌุฑ ุงููุฏููุฉ

1. ุงูุชุญ ุญุณุงุจ **Network Owner**
2. ุงุฐูุจ ุฅูู ุชุจููุจ "ุงููุชุงุฌุฑ"
3. **ุงุถุบุท ุนูู ุฃููููุฉ ๐๏ธ** ูู ุฃุนูู ูุณุงุฑ ูู ูุชุฌุฑ
4. ุฃููุฏ ุงูุญุฐู
5. ูุฑูุฑ ูุฌููุน ุงููุชุงุฌุฑ

### ุงูุฎุทูุฉ 2: ุฅุนุงุฏุฉ ุฅุถุงูุฉ ุงููุชุงุฌุฑ

6. ุงุถุบุท ุนูู ุฃููููุฉ **+** ูู ุงูุฃุนูู
7. ุงุจุญุซ ุนู ุงููุชุฌุฑ (ูุซูุงู: 777333444)
8. ุงุถุบุท "ุฅุถุงูุฉ"
9. ุฑุงูุจ Debug Console:
```
๐ ูุญุงููุฉ ุฅุถุงูุฉ ุงููุชุฌุฑ: ูุญูู ุนุจุฏูู ูุงุฑุน
   - Network ID: bVafzODl7SPc8iyg5ce2nXB8Yl42
   - User ID ูู users collection: I1Xk9X7a32PW5apyAJ3zpaZryOc2  โ ูุฌุจ ุฃู ูุธูุฑ!
๐พ ูุญุงููุฉ ุญูุธ ุงููุชุฌุฑ ูู Firestore...
   Collection: vendors
   User ID: I1Xk9X7a32PW5apyAJ3zpaZryOc2  โ ูุฌุจ ุฃู ูุธูุฑ!
โ ุชู ุญูุธ ุงููุชุฌุฑ ุจูุฌุงุญ - Document ID = User ID: I1Xk9X7a32PW5apyAJ3zpaZryOc2
```

### ุงูุฎุทูุฉ 3: ุฅูุดุงุก ุทูุจ ูุงุฎุชุจุงุฑ

10. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ **ุงููุชุฌุฑ** (777333444)
11. ุฃุฑุณู ุทูุจ ูุฑูุช
12. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ **Network Owner** (777854698)
13. ูุงูู ุนูู ุงูุทูุจ
14. ุฑุงูุจ Debug Console:
```
โ Transaction recorded for order: XXX
   - vendorId: I1Xk9X7a32PW5apyAJ3zpaZryOc2  โ user ID
   - networkId: bVafzODl7SPc8iyg5ce2nXB8Yl42
   - reference: ORD-XXXXX
```

### ุงูุฎุทูุฉ 4: ูุชุญ ุตูุญุฉ ูุนุงููุงุช ุงููุชุฌุฑ

15. ูู ุญุณุงุจ **Network Owner**ุ ุงุฐูุจ ุฅูู "ุงููุชุงุฌุฑ"
16. ุงุถุบุท ุนูู "ูุญูู ุนุจุฏูู ูุงุฑุน"
17. ุฑุงูุจ Debug Console:
```
๐ Fetching transactions for:
   - vendorId: I1Xk9X7a32PW5apyAJ3zpaZryOc2  โ user ID
   - networkId: bVafzODl7SPc8iyg5ce2nXB8Yl42
๐ฅ Transactions received: 1              โ ูุนุงููุฉ ูุงุญุฏุฉ!
   - XXX: ุทูุจ ูุฑูุช...
```

18. **ูุฌุจ ุฃู ุชุธูุฑ ุงููุนุงููุฉ ูู ุงููุงุฌูุฉ!** ๐

---

## ๐จ ุดูู ุฒุฑ ุงูุญุฐู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐๏ธ                    [ุงูุฑุตูุฏ]    โ โ ุงุถุบุท ููุง ููุญุฐู
โ                       0 ุฑ.ู       โ
โ                       โโโโโโโโโ    โ
โ                       [ุงููุฎุฒูู]   โ
โ  [ู]  ูุญูู ุนุจุฏูู ูุงุฑุน    0        โ
โ       ูุญูู ุนุจุฏูู ูุงุฑุน             โ
โ       ๐ฑ 777333444 ๐ ุดุจูุฉุ ุนุชู    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ๏ธ ุชุญุฐูุฑ ุงูุญุฐู

ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุญุฐูุ ุณุชุธูุฑ ูุงูุฐุฉ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุญุฐู ุงููุชุฌุฑ                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ูู ุชุฑูุฏ ุญุฐู "ูุญูู ุนุจุฏูู ูุงุฑุน"      โ
โ ูู ูุงุฆูุฉ ุงููุชุงุฌุฑุ                  โ
โ                                     โ
โ โ๏ธ ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช          โ
โ    ุงููุฑุชุจุทุฉ ุจูุฐุง ุงููุชุฌุฑ            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ           [ุฅูุบุงุก]      [ุญุฐู] ๐ด    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ ุงููุชูุฌุฉ

**ุจุนุฏ ุฅุนุงุฏุฉ ุฅุถุงูุฉ ุงููุชุงุฌุฑ:**

1. โ **vendors collection:**
   - Document ID = User ID
   - ูููู ุงูุงุณุชุนูุงู ุจุณูููุฉ

2. โ **transactions collection:**
   - vendorId = User ID
   - ุชุธูุฑ ูู ุตูุญุฉ ุงููุนุงููุงุช

3. โ **ุงูุชูุงูู ุงููุงูู:**
   - ุงููุชุงุฌุฑ ุงูุฌุฏูุฏุฉ ุชุนูู ุจุดูู ุตุญูุญ
   - ุงููุนุงููุงุช ุชุธูุฑ ุจูุฌุงุญ
   - ูููู ุงูุญุฐู ุจุณูููุฉ

---

## ๐ ุฌุงูุฒ ููุงุฎุชุจุงุฑ!

**ูู ุจูุง ููู:**
1. โ ุงุญุฐู ุงููุชุฌุฑ ุงููุฏูู (ุงุถุบุท ๐๏ธ)
2. โ ุฃุนุฏ ุฅุถุงูุฉ ุงููุชุฌุฑ (ุงุถุบุท +)
3. โ ุฃูุดุฆ ุทูุจ ููุงูู ุนููู
4. โ ุงูุชุญ ุตูุญุฉ ูุนุงููุงุช ุงููุชุฌุฑ
5. โ **ุณุชุธูุฑ ุงููุนุงููุงุช!** ๐

---

**ุชูุช ุฌููุน ุงูุฅุตูุงุญุงุช ุจูุฌุงุญ!** ๐ชโจ

