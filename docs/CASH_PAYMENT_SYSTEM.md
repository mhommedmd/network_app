# ูุธุงู ุงูุฏูุนุงุช ุงูููุฏูุฉ - Cash Payment System

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุงูู ูุชุณุฌูู ุงูุฏูุนุงุช ุงูููุฏูุฉ ูู ุงูุดุจูุฉ ูููุชุงุฌุฑ ูุน ุขููุฉ ููุงููุฉ ูู ุงููุชุฌุฑ.

---

## ๐ ุขููุฉ ุงูุนูู

### **ุงูุณููุงุฑูู ุงููุงูู:**

```
1๏ธโฃ ูุงูู ุงูุดุจูุฉ:
   โโ ูุณุฌู ุฏูุนุฉ ููุฏูุฉ
   โโ ูุฎุชุงุฑ ุงููุชุฌุฑ ุงููุณุชูู
   โโ ูุฏุฎู ุงููุจูุบ ูุงูุจูุงู
   โโ ูุถุบุท "ุฅุฑุณุงู"

2๏ธโฃ ุงููุธุงู:
   โโ ููุดุฆ payment_request ุจุญุงูุฉ "pending"
   โโ ููุดุฆ transaction ุจุญุงูุฉ "pending"
   โโ ูุฑุณู ุฅุดุนุงุฑ ูููุชุฌุฑ
   โโ ูุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ

3๏ธโฃ ุงููุชุฌุฑ:
   โโ ูุณุชูู ุฅุดุนุงุฑ
   โโ ููุชุญ ุทูุจ ุงูููุงููุฉ
   โโ ููุงูู ุฃู ูุฑูุถ

4๏ธโฃ ุนูุฏ ุงูููุงููุฉ:
   โโ ุชุชุญุฏุซ ุญุงูุฉ payment_request โ "approved"
   โโ ุชุชุญุฏุซ ุญุงูุฉ transaction โ "completed"
   โโ ูุชู ุชุญุฏูุซ ุฑุตูุฏ ุงููุชุฌุฑ
   โโ ูุฑุณู ุฅุดุนุงุฑ ููุงูู ุงูุดุจูุฉ

5๏ธโฃ ุนูุฏ ุงูุฑูุถ:
   โโ ุชุชุญุฏุซ ุญุงูุฉ payment_request โ "rejected"
   โโ ุชูุญุฐู ุฃู ุชููุบู transaction
   โโ ูุฑุณู ุฅุดุนุงุฑ ููุงูู ุงูุดุจูุฉ
```

---

## ๐๏ธ ุงููููู ุงูููู

### **Collections:**

#### 1. **payment_requests**
```json
{
  "id": "req_123",
  "vendorId": "vendor_456",
  "networkId": "network_789",
  "amount": 5000,
  "description": "ุฏูุนุฉ ููุฏูุฉ ููุจูุนุงุช ุงูุฃุณุจูุน",
  "status": "pending",          // pending | approved | rejected
  "createdAt": "2025-10-26...",
  "approvedAt": null,
  "rejectedAt": null,
  "notes": "ููุงุญุธุงุช ุฅุถุงููุฉ"
}
```

#### 2. **transactions**
```json
{
  "vendorId": "vendor_456",
  "networkId": "network_789",
  "type": "payment",
  "amount": -5000,               // ุณุงูุจ ููุฏูุนุงุช
  "description": "ุฏูุนุฉ ููุฏูุฉ ููุจูุนุงุช ุงูุฃุณุจูุน",
  "reference": "PAY-req_123",
  "status": "pending",           // pending โ completed
  "balanceAfter": 0,
  "createdBy": "network_789",
  "method": "cash",
  "date": "2025-10-26...",
  "notes": "ูู ุงูุชุธุงุฑ ููุงููุฉ ุงููุชุฌุฑ"
}
```

#### 3. **notifications**
```json
{
  "recipientId": "vendor_456",
  "senderId": "network_789",
  "type": "payment_request",
  "title": "ุทูุจ ููุงููุฉ ุนูู ุฏูุนุฉ ููุฏูุฉ",
  "body": "ุชู ุฅุฑุณุงู ุทูุจ ูุชุฃููุฏ ุงุณุชูุงู ุฏูุนุฉ ููุฏูุฉ ุจูููุฉ 5000 ุฑ.ู",
  "data": {
    "paymentRequestId": "req_123",
    "amount": 5000
  },
  "isRead": false,
  "createdAt": "2025-10-26..."
}
```

---

## ๐ฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### **ุตูุญุฉ ุชุณุฌูู ุฏูุนุฉ ููุฏูุฉ:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  ุชุณุฌูู ุฏูุนู ููุฏูุฉ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                      โ
โ  ุงุฎุชุฑ ุงููุชุฌุฑ                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ูุชุฌุฑ ุงูููุฑ             โผ      โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                      โ
โ  ูููุฉ ุงูุฏูุนู ุงูููุฏูุฉ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ 5000                           โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                      โ
โ  ุจูุงู ุงูุฏูุนู ุงูููุฏูุฉ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ุฏูุนุฉ ููุฏูุฉ ููุจูุนุงุช ุงูุฃุณุจูุน    โ โ
โ  โ                                โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                      โ
โ  โโโโโโโโโโโโฌโโโโโโโโโโโโ          โ
โ  โ  ุฅูุบุงุก    โ  ุฅุฑุณุงู    โ          โ
โ  โโโโโโโโโโโโดโโโโโโโโโโโโ          โ
โ                                      โ
โ  โน๏ธ ุณูุชู ุฅุฑุณุงู ุทูุจ ููุงููุฉ ูููุชุฌุฑ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ุงูููุฒุงุช

### โ **ููุดุจูุฉ (Network Owner):**
- ุงุฎุชูุงุฑ ุงููุชุฌุฑ ูู ุงููุงุฆูุฉ ุงููุถุงูุฉ
- ุฅุฏุฎุงู ูุจูุบ ุงูุฏูุนุฉ
- ูุชุงุจุฉ ุจูุงู ุชูุถูุญู
- ุฅุฑุณุงู ุทูุจ ููุงููุฉ
- ุชุชุจุน ุญุงูุฉ ุงูุทูุจ

### โ **ูููุชุฌุฑ (POS Vendor):**
- ุงุณุชูุงู ุฅุดุนุงุฑ ุจุงูุฏูุนุฉ
- ุนุฑุถ ุชูุงุตูู ุงูุฏูุนุฉ
- ุงูููุงููุฉ ุฃู ุงูุฑูุถ
- ุชุญุฏูุซ ุงูุฑุตูุฏ ุชููุงุฆูุงู

### โ **ุงููุธุงู:**
- ุฅูุดุงุก ูุนุงููุฉ ุจุญุงูุฉ "pending"
- ุชุญุฏูุซ ุงูุญุงูุฉ ุนูุฏ ุงูููุงููุฉ/ุงูุฑูุถ
- ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุทุฑููู
- ุชุญุฏูุซ ุงูุฑุตูุฏ ุชููุงุฆูุงู

---

## ๐ ุงูุฃูุงู

### **ููุงุนุฏ Firebase:**

```javascript
// payment_requests
allow read: if authenticated
allow create: if networkId == uid
allow update: if authenticated  // ูููุชุฌุฑ ูุชุบููุฑ ุงูุญุงูุฉ

// transactions
allow read: if authenticated
allow create: if networkId == uid

// notifications
allow read, create, update: if authenticated
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **1. ุฅุฑุณุงู ุฏูุนุฉ:**
1. ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ "ุฏูุนุฉ ููุฏูุฉ"
2. ุงุฎุชุฑ ูุชุฌุฑ
3. ุฃุฏุฎู ุงููุจูุบ: `5000`
4. ุฃุฏุฎู ุงูุจูุงู: `ุฏูุนุฉ ููุฏูุฉ ููุจูุนุงุช ุงูุฃุณุจูุน`
5. ุงุถุบุท "ุฅุฑุณุงู"

### **2. ุงูุชุญูู ูู Firebase:**

**ูู `payment_requests`:**
```
โ ูุฌุจ ุฃู ูุธูุฑ ุทูุจ ุฌุฏูุฏ
โ status: "pending"
โ amount: 5000
```

**ูู `transactions`:**
```
โ ูุฌุจ ุฃู ุชุธูุฑ ูุนุงููุฉ ุฌุฏูุฏุฉ
โ type: "payment"
โ amount: -5000 (ุณุงูุจ)
โ status: "pending"
```

**ูู `notifications`:**
```
โ ูุฌุจ ุฃู ูุธูุฑ ุฅุดุนุงุฑ ูููุชุฌุฑ
โ type: "payment_request"
โ isRead: false
```

### **3. ุนุฑุถ ุงููุนุงููุฉ:**
- ุงุฐูุจ ูุตูุญุฉ ุงููุชุงุฌุฑ
- ุงุถุบุท ุนูู ุงููุชุฌุฑ
- **ูุฌุจ ุฃู ุชุธูุฑ ุงููุนุงููุฉ ุจุญุงูุฉ "pending"** โณ

---

## ๐ ุงููููุงุช ุงูููุดุฃุฉ/ุงููุญุฏุซุฉ

```
โจ ุฌุฏูุฏ:
   - payment_request_model.dart
   - firebase_payment_service.dart
   - CASH_PAYMENT_SYSTEM.md

โ๏ธ ูุญุฏุซ:
   - cash_payment_page.dart (ุจูุงูุงุช ุญููููุฉ)
   - firestore.rules (ููุงุนุฏ payment_requests + notifications)
   - firestore.indexes.json (ููุงุฑุณ payment_requests)
```

---

## ๐ ุงููุชูุฌุฉ

โ **ุงุฎุชูุงุฑ ูู ุงููุชุงุฌุฑ ุงูุญููููุฉ**  
โ **ุฅุฑุณุงู ุทูุจ ููุงููุฉ**  
โ **ุฅูุดุงุก ูุนุงููุฉ ูุนููุฉ**  
โ **ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุชุฌุฑ**  
โ **ุชูุงูู ูุน ูุธุงู ุงููุนุงููุงุช**  
โ **real-time updates**  

---

**๐ ุฌุฑูุจ ุงูุขู:**
1. ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ "ุฏูุนุฉ ููุฏูุฉ"
2. ุงุฎุชุฑ ูุชุฌุฑ
3. ุฃุฏุฎู ุงูุจูุงูุงุช
4. ุฅุฑุณุงู!

**๐ ูููุฒูุฏ:**
- ุฑุงุฌุน: `docs/CASH_PAYMENT_SYSTEM.md`

