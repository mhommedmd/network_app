# ๐ ูุธุงู ุงูุฅุดุนุงุฑุงุช - ููุชูู

## โ ุชู ุงูุชูููุฐ ุจุงููุงูู

ุชู ุฅูุดุงุก ูุธุงู ุฅุดุนุงุฑุงุช ุดุงูู ููุชูุงูู ูุนูู ุจุดูู ููุฑู ููู ุงูููุช ุงููุนูู.

---

## ๐ ุงูุฅุดุนุงุฑุงุช ุงูููููุฐุฉ

### 1๏ธโฃ **ุฅุดุนุงุฑุงุช ุงููุชุฌุฑ (POS Vendor)**

#### **ุทูุจ ุฌุฏูุฏ ุชูุช ุงูููุงููุฉ ุนููู**
- **ุงููุญุชูู:** "ูุงูู [ุงุณู ุงูุดุจูุฉ] ุนูู ุทูุจู ูุชู ุฅุถุงูุฉ [ุนุฏุฏ] ูุฑุช ุฅูู ูุฎุฒููู"
- **ุงูุฃููููุฉ:** โ (check_circle_outline)
- **ุงูููู:** ุฃุฎุถุฑ
- **ุงูุชููู:** ููุชุญ ุงููุฎุฒูู

#### **ุทูุจ ุชู ุฑูุถู**
- **ุงููุญุชูู:** "ุฑูุถ [ุงุณู ุงูุดุจูุฉ] ุทูุจู. ููููู ุงูุชูุงุตู ูุนูู ููุนุฑูุฉ ุงูุณุจุจ"
- **ุงูุฃููููุฉ:** โ (cancel_outlined)
- **ุงูููู:** ุฃุญูุฑ
- **ุงูุชููู:** ููุชุญ ุชูุงุตูู ุงูุทูุจ

#### **ุฏูุนุฉ ููุฏูุฉ ุฌุฏูุฏุฉ**
- **ุงููุญุชูู:** "ุฃุฑุณู ูู [ุงุณู ุงูุดุจูุฉ] ุฏูุนุฉ ููุฏูุฉ ุจูุจูุบ [ุงููุจูุบ] ุฑ.ู"
- **ุงูุฃููููุฉ:** ๐ฐ (payments_outlined)
- **ุงูููู:** ุฃุฒุฑู (primary)
- **ุงูุชููู:** ููุชุญ ุตูุญุฉ ุงูุฏูุนุงุช ุงูููุฏูุฉ

### 2๏ธโฃ **ุฅุดุนุงุฑุงุช ูุงูู ุงูุดุจูุฉ (Network Owner)**

#### **ุทูุจ ุฌุฏูุฏ ูู ูุชุฌุฑ**
- **ุงููุญุชูู:** "ุงุณุชููุช ุทูุจ ูุฑูุช ุฌุฏูุฏ ูู [ุงุณู ุงููุชุฌุฑ]"
- **ุงูุฃููููุฉ:** ๐๏ธ (shopping_bag_outlined)
- **ุงูููู:** ุฃุฒุฑู (primary)
- **ุงูุชููู:** ููุชุญ ุชูุงุตูู ุงูุทูุจ

#### **ุชู ุชุฃููุฏ ุงูุฏูุนุฉ ุงูููุฏูุฉ**
- **ุงููุญุชูู:** "ุฃูุฏ [ุงุณู ุงููุชุฌุฑ] ุงุณุชูุงู ุฏูุนุฉ [ุงููุจูุบ] ุฑ.ู"
- **ุงูุฃููููุฉ:** โ (verified_outlined)
- **ุงูููู:** ุฃุฎุถุฑ
- **ุงูุชููู:** ููุชุญ ุงููุนุงููุงุช

#### **ุชู ุฑูุถ ุงูุฏูุนุฉ ุงูููุฏูุฉ**
- **ุงููุญุชูู:** "ุฑูุถ [ุงุณู ุงููุชุฌุฑ] ุฏูุนุฉ [ุงููุจูุบ] ุฑ.ู"
- **ุงูุฃููููุฉ:** โ (highlight_off_outlined)
- **ุงูููู:** ุฃุญูุฑ
- **ุงูุชููู:** ููุชุญ ุตูุญุฉ ุงูุฏูุนุงุช

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### 1. **ูููุฐุฌ ุงูุจูุงูุงุช** (`notification_model.dart`)
```dart
class NotificationModel {
  String id;
  String userId;        // ุงููุณุชูู
  String type;          // ููุน ุงูุฅุดุนุงุฑ
  String title;         // ุงูุนููุงู
  String body;          // ุงููุญุชูู
  bool isRead;          // ุญุงูุฉ ุงููุฑุงุกุฉ
  DateTime createdAt;
  Map<String, dynamic>? data;  // ุจูุงูุงุช ููุชููู
}
```

### 2. **ุฎุฏูุฉ Firebase** (`firebase_notification_service.dart`)

#### **ุฏูุงู ุนุงูุฉ:**
- โ `createNotification()` - ุฅูุดุงุก ุฅุดุนุงุฑ
- โ `getUserNotifications()` - ุฌูุจ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู (Stream)
- โ `getUnreadCount()` - ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ `markAsRead()` - ุชุญุฏูุฏ ูููุฑูุก
- โ `markAllAsRead()` - ุชุญุฏูุฏ ุงููู ูููุฑูุก
- โ `deleteNotification()` - ุญุฐู ุฅุดุนุงุฑ
- โ `deleteReadNotifications()` - ุญุฐู ุงูููุฑูุกุฉ

#### **ุฏูุงู ูุชุฎุตุตุฉ:**
- โ `notifyNewOrder()` - ุฅุดุนุงุฑ ุทูุจ ุฌุฏูุฏ
- โ `notifyOrderApproved()` - ุฅุดุนุงุฑ ููุงููุฉ ุนูู ุทูุจ
- โ `notifyOrderRejected()` - ุฅุดุนุงุฑ ุฑูุถ ุทูุจ
- โ `notifyNewPayment()` - ุฅุดุนุงุฑ ุฏูุนุฉ ุฌุฏูุฏุฉ
- โ `notifyPaymentApproved()` - ุฅุดุนุงุฑ ููุงููุฉ ุนูู ุฏูุนุฉ
- โ `notifyPaymentRejected()` - ุฅุดุนุงุฑ ุฑูุถ ุฏูุนุฉ

### 3. **ุงูุชูุงูู ูุน ุงูุฎุฏูุงุช ุงูุฃุฎุฑู**

#### **ุฎุฏูุฉ ุงูุทูุจุงุช** (`firebase_order_service.dart`)
```dart
// ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
createOrder() {
  await FirebaseNotificationService.notifyNewOrder(...);
}

// ุนูุฏ ุงูููุงููุฉ ุนูู ุทูุจ
approveOrder() {
  await FirebaseNotificationService.notifyOrderApproved(...);
}

// ุนูุฏ ุฑูุถ ุทูุจ
rejectOrder() {
  await FirebaseNotificationService.notifyOrderRejected(...);
}
```

#### **ุฎุฏูุฉ ุงูุฏูุนุงุช** (`firebase_cash_payment_service.dart`)
```dart
// ุนูุฏ ุฅูุดุงุก ุฏูุนุฉ
createPaymentRequest() {
  await FirebaseNotificationService.notifyNewPayment(...);
}

// ุนูุฏ ุงูููุงููุฉ
approvePaymentRequest() {
  await FirebaseNotificationService.notifyPaymentApproved(...);
}

// ุนูุฏ ุงูุฑูุถ
rejectPaymentRequest() {
  await FirebaseNotificationService.notifyPaymentRejected(...);
}
```

### 4. **ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช** (`notifications_page.dart`)

#### **ุงููููุฒุงุช:**
- โ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู (`StreamBuilder`)
- โ ุญุงูุงุช ุชุญููู ุงุญุชุฑุงููุฉ (`SkeletonLoading`)
- โ ุญุงูุฉ ูุงุฑุบุฉ ุฌูููุฉ
- โ ุญุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
- โ ุณุญุจ ููุญุฐู (`Dismissible`)
- โ ุฒุฑ "ุชุญุฏูุฏ ุงููู ูููุฑูุก"
- โ ุนุฑุถ ุงูููุช ุงููุณุจู ("ููุฐ 5 ุฏูุงุฆู")
- โ ููุทุฉ ุฒุฑูุงุก ููุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- โ ุฃููุงู ูุฎุชููุฉ ุญุณุจ ููุน ุงูุฅุดุนุงุฑ
- โ ุฃููููุงุช ูุฎุตุตุฉ ููู ููุน
- โ Pull to Refresh

---

## ๐ ููุงุนุฏ Firebase Security

ุชู ุฅุถุงูุฉ ููุงุนุฏ ุฃูุงู ุดุงููุฉ ููุฅุดุนุงุฑุงุช:

```javascript
match /notifications/{notificationId} {
  // ุงููุฑุงุกุฉ ูุงูุชุญุฏูุซ ูุงูุญุฐู: ุงููุณุชุฎุฏู ุงููุณุชูู ููุท
  allow read, update, delete: if isAuthenticated() && 
                                 resource.data.userId == getUserId();
  
  // ุงูุฅูุดุงุก: ุฃู ูุณุชุฎุฏู ูุตุงุฏู ุนููู
  allow create: if isAuthenticated();
}
```

---

## ๐ ุชุฏูู ุงูุนูู ุงููุงูู

### **ูุซุงู: ุทูุจ ูุฑูุช ุฌุฏูุฏ**

```
1. ุงููุชุฌุฑ ูุฑุณู ุทูุจ
   โ
2. createOrder() โ notifyNewOrder()
   โ
3. ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ ูู Firebase
   userId: networkId
   type: "order_new"
   โ
4. ูุงูู ุงูุดุจูุฉ ูุฑู ุงูุฅุดุนุงุฑ ููุฑุงู
   (StreamBuilder ูุณุชูู ุงูุชุญุฏูุซ)
   โ
5. ูุงูู ุงูุดุจูุฉ ูุถุบุท ุนูู ุงูุฅุดุนุงุฑ
   โ ูุชู ุชุญุฏูุฏู ูููุฑูุก
   โ ููุชูู ูุตูุญุฉ ุชูุงุตูู ุงูุทูุจ
   โ
6. ูุงูู ุงูุดุจูุฉ ููุงูู ุนูู ุงูุทูุจ
   โ
7. approveOrder() โ notifyOrderApproved()
   โ
8. ุงููุชุฌุฑ ูุชููู ุฅุดุนุงุฑ ุงูููุงููุฉ
   "ุชูุช ุฅุถุงูุฉ X ูุฑุช ุฅูู ูุฎุฒููู"
```

### **ูุซุงู: ุฏูุนุฉ ููุฏูุฉ**

```
1. ูุงูู ุงูุดุจูุฉ ูุฑุณู ุฏูุนุฉ
   โ
2. createPaymentRequest() โ notifyNewPayment()
   โ
3. ุงููุชุฌุฑ ูุฑู ุฅุดุนุงุฑ "ุฏูุนุฉ ุฌุฏูุฏุฉ"
   โ
4. ุงููุชุฌุฑ ูุถุบุท โ ููุชุญ ุตูุญุฉ ุงูุฏูุนุงุช
   โ
5. ุงููุชุฌุฑ ููุงูู/ูุฑูุถ
   โ
6. ูุงูู ุงูุดุจูุฉ ูุชููู ุฅุดุนุงุฑ ุจุงููุชูุฌุฉ
```

---

## ๐จ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (UX)

### **ูุคุดุฑุงุช ุจุตุฑูุฉ:**
- ๐ต **ููุทุฉ ุฒุฑูุงุก** ููุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- ๐จ **ุฃููุงู ูููุฒุฉ** ููู ููุน ุฅุดุนุงุฑ
- ๐ **ููุช ูุณุจู** ("ููุฐ 5 ุฏูุงุฆู" ุจุฏูุงู ูู ุงูุชุงุฑูุฎ)
- ๐ช **ุฎุท ุนุฑูุถ** ููุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ
- ๐ **ุฎุท ุนุงุฏู** ููููุฑูุกุฉ

### **ุชูุงุนูุงุช:**
- โ๏ธ **ุงุถุบุท** โ ูุชุญ ุงูุตูุญุฉ ุงููุฑุชุจุทุฉ + ุชุญุฏูุฏ ูููุฑูุก
- ๐ **ุงุณุญุจ** โ ุญุฐู ุงูุฅุดุนุงุฑ
- ๐ **Pull Down** โ ุชุญุฏูุซ
- โ **ุฃููููุฉ ูู AppBar** โ ุชุญุฏูุฏ ุงููู ูููุฑูุก

---

## ๐ ุงูุฃุฏุงุก ูุงูุชุญุณููุงุช

### **1. Stream ุจุฏูุงู ูู Polling**
- ุชุญุฏูุซุงุช ููุฑูุฉ ุจุฏูู ุชุฃุฎูุฑ
- ุงุณุชููุงู ุฃูู ููุจูุงูุงุช
- ูุง ุญุงุฌุฉ ูุทูุจุงุช ูุชูุฑุฑุฉ

### **2. Skeleton Loading**
- ุชุฌุฑุจุฉ ุชุญููู ุณูุณุฉ
- ูุง ุดุงุดุงุช ุจูุถุงุก
- ูุธูุฑ ุงุญุชุฑุงูู

### **3. Error Handling**
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุขูู
- ุนุฏู ูุดู ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ
- ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู

### **4. Offline Support**
- Firebase ูุฎุฒู ุงูุจูุงูุงุช ูุญููุงู
- ุชุนูู ุญุชู ุจุฏูู ุฅูุชุฑูุช
- ุชุฒุงูู ุชููุงุฆู ุนูุฏ ุงูุนูุฏุฉ ุฃูููุงูู

---

## ๐ฑ ุงูุงุณุชุฎุฏุงู

### **ูููุตูู ููุฅุดุนุงุฑุงุช:**

#### **ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ:**
```dart
// ูู AppBar
IconButton(
  icon: Badge(
    label: StreamBuilder<int>(
      stream: FirebaseNotificationService.getUnreadCount(userId),
      builder: (context, snapshot) {
        final count = snapshot.data ?? 0;
        return Text('$count');
      },
    ),
    child: Icon(Icons.notifications),
  ),
  onPressed: () {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (_) => NotificationsPage(),
      ),
    );
  },
)
```

### **ููุญุตูู ุนูู ุนุฏุฏ ุบูุฑ ุงูููุฑูุกุฉ:**
```dart
StreamBuilder<int>(
  stream: FirebaseNotificationService.getUnreadCount(userId),
  builder: (context, snapshot) {
    final count = snapshot.data ?? 0;
    return Badge(label: Text('$count'));
  },
)
```

---

## โ ุงุฎุชุจุงุฑ ุงููุธุงู

### **ุณููุงุฑูู 1: ุทูุจ ุฌุฏูุฏ**
1. ูู ุญุณุงุจ ูุชุฌุฑ โ ุฃุฑุณู ุทูุจ ูุฑูุช
2. ุงูุชูู ูุญุณุงุจ ูุงูู ุงูุดุจูุฉ
3. โ ูุฌุจ ุฃู ุชุธูุฑ ุฅุดุนุงุฑ ููุฑุงู
4. ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ
5. โ ูุฌุจ ุฃู ููุชูู ูุตูุญุฉ ุงูุทูุจุงุช

### **ุณููุงุฑูู 2: ุฏูุนุฉ ููุฏูุฉ**
1. ูู ุญุณุงุจ ูุงูู ุงูุดุจูุฉ โ ุฃุฑุณู ุฏูุนุฉ
2. ุงูุชูู ูุญุณุงุจ ุงููุชุฌุฑ
3. โ ูุฌุจ ุฃู ุชุธูุฑ ุฅุดุนุงุฑ ููุฑุงู
4. ุงุถุบุท ุนูู ุงูุฅุดุนุงุฑ
5. โ ูุฌุจ ุฃู ููุชุญ ุตูุญุฉ ุงูุฏูุนุงุช

### **ุณููุงุฑูู 3: ุณุญุจ ููุญุฐู**
1. ุงูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช
2. ุงุณุญุจ ุฅุดุนุงุฑ ูู ุงููููู ูููุณุงุฑ
3. โ ูุฌุจ ุฃู ููุญุฐู ุงูุฅุดุนุงุฑ ููุฑุงู

---

## ๐ ุงูุฎูุงุตุฉ

### โ **ุชู ุฅูุฌุงุฒู:**
1. โ ูููุฐุฌ ุจูุงูุงุช ุดุงูู
2. โ ุฎุฏูุฉ Firebase ูุงููุฉ
3. โ 6 ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฅุดุนุงุฑุงุช
4. โ ุชูุงูู ูุน ุฌููุน ุงูุฎุฏูุงุช
5. โ ุตูุญุฉ ุงุญุชุฑุงููุฉ ููุฅุดุนุงุฑุงุช
6. โ ููุงุนุฏ ุฃูุงู Firebase
7. โ ุชุญุฏูุซุงุช ููุฑูุฉ ูู ุงูููุช ุงููุนูู
8. โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ

### ๐ฏ **ุงููุชูุฌุฉ:**
ูุธุงู ุฅุดุนุงุฑุงุช **ูุชูุงูู** ู**ุงุญุชุฑุงูู** ูุนูู ุจุดูู **ููุฑู** ููุบุทู ุฌููุน **ุญุงูุงุช ุงูุงุณุชุฎุฏุงู** ุงููุทููุจุฉ!

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุชู ูุดุฑ ุงูููุงุนุฏ:** ููุงุนุฏ Firebase ุชู ูุดุฑูุง ูุชุนูู โ
2. **ุงูุฏูุนุงุช ุงูููุฏูุฉ:** ุชู ุฅุตูุงุญ ูุดููุฉ ุงูุตูุงุญูุงุช โ
3. **ุงูุฅุดุนุงุฑุงุช:** ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ุงูููุฑู โ
4. **ุงูุชููู:** ูุนูู ุชููุงุฆูุงู ุนูุฏ ุงูุถุบุท ุนูู ุงูุฅุดุนุงุฑ โ

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ (ุงุฎุชูุงุฑู)

ุฅุฐุง ุฃุฑุฏุช ุชุญุณููุงุช ุฅุถุงููุฉ:
- ๐ง ุฅุดุนุงุฑุงุช Push (FCM)
- ๐ ุฃุตูุงุช ููุฅุดุนุงุฑุงุช
- ๐ฒ ุฅุดุนุงุฑุงุช ูุญููุฉ (Local Notifications)
- ๐ฏ ููุชุฑุฉ ูุจุญุซ ูู ุงูุฅุดุนุงุฑุงุช
- ๐ ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช

**ููู ุงููุธุงู ุงูุญุงูู ูุงูู ููุนูู ุจุดูู ููุชุงุฒ! ๐**

