# โ ุฅุตูุงุญ ุตูุงุญูุงุช ุงูุจูุน ููุณุชุฎุฏูู POS Vendor

## ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ูุณุชุฎุฏู `posVendor` ุจูุน ูุฑูุชุ ูุงู ูุธูุฑ ุฎุทุฃ:
```
ูุดู ุงูุจูุน: ููุณ ูุฏูู ุงูุตูุงุญูุฉ ูุชูููุฐ ูุฐุง ุงูุฅุฌุฑุงุก
PERMISSION_DENIED
```

---

## ุงูุณุจุจ

### ุงููุงุนุฏุฉ ุงููุฏููุฉ (ุงูุฎุงุทุฆุฉ):
```javascript
match /cards/{cardId} {
  allow read: if isAuthenticated();
  allow create: if isNetworkOwner();
  allow update, delete: if isNetworkOwner() && 
                          resource.data.networkId == getUserId();
}
```

### ุงููุดููุฉ:
- โ ููุท `networkOwner` ููููู ุชุญุฏูุซ `cards`
- โ ุนูุฏ ุงูุจูุนุ `posVendor` ูุญุงูู ุชุญุฏูุซ ุญุงูุฉ ุงููุฑุช ูู `transferred` ุฅูู `sold`
- โ ุงููุงุนุฏุฉ ุชุฑูุถ ุงูุนูููุฉ โ `PERMISSION_DENIED`

---

## ุงูุญู ุงูููุทุจู

### ุงููุงุนุฏุฉ ุงูุฌุฏูุฏุฉ (ุงูุตุญูุญุฉ):
```javascript
match /cards/{cardId} {
  allow read: if isAuthenticated();
  allow create: if isNetworkOwner();
  
  // ุงูุณูุงุญ ููุงูู ุงูุดุจูุฉ ุจุฌููุน ุงูุชุญุฏูุซุงุช ูุงูุญุฐู
  allow update, delete: if isNetworkOwner() && 
                          resource.data.networkId == getUserId();
  
  // ุงูุณูุงุญ ูููุชุฌุฑ ุจุชุญุฏูุซ ุญุงูุฉ ุงููุฑุช ุฅูู 'sold' ููุท ุนูุฏ ุงูุจูุน
  allow update: if isVendor() && 
                  resource.data.status == 'transferred' &&
                  request.resource.data.status == 'sold' &&
                  request.resource.data.keys().hasOnly(['status', 'soldAt', 'soldTo']);
}
```

---

## ุงูุดุฑูุท ุงูุฃูููุฉ

### ุดุฑูุท ุชุญุฏูุซ ุงููุฑุช ูู ูุจู ุงููุชุฌุฑ:
1. โ `isVendor()` - ุงููุณุชุฎุฏู ููุนู `posVendor`
2. โ `resource.data.status == 'transferred'` - ุงููุฑุช ููููู ูููุชุฌุฑ
3. โ `request.resource.data.status == 'sold'` - ุงูุชุญุฏูุซ ุฅูู ุญุงูุฉ `sold`
4. โ `keys().hasOnly(['status', 'soldAt', 'soldTo'])` - ููุท ูุฐู ุงูุญููู

### ูุง ูุง ููุณูุญ ุจู:
- โ ุชุญุฏูุซ ูุฑูุช ุจุญุงูุฉ `available` (ููู ุงูุดุจูุฉ)
- โ ุชุญุฏูุซ ุฅูู ุฃู ุญุงูุฉ ุบูุฑ `sold`
- โ ุชุนุฏูู ุญููู ุฃุฎุฑู (packageId, cardNumber, ...)
- โ ุญุฐู ุงููุฑูุช

---

## ุณูุฑ ุงูุนูู

### ุนูุฏ ุจูุน ูุฑุช:

```
1. ุงููุชุฌุฑ ูุฎุชุงุฑ ูุฑูุช ููุจูุน
   โ
2. FirebaseSaleService.sellCards()
   โ
3. Firestore Transaction:
   โโโ ุชุญุฏูุซ vendor_cards/{id}
   โ   โโโ status: 'sold' โ
   โ
   โโโ ุชุญุฏูุซ cards/{id}
       โโโ ุงูุชุญูู: isVendor() โ
       โโโ ุงูุชุญูู: status == 'transferred' โ
       โโโ ุงูุชุญูู: new status == 'sold' โ
       โโโ ุงูุชุญูู: ุงูุญููู ุงููุญุฏุซุฉ ููุท โ
       โโโ status: 'sold' โ ูุณููุญ!
   โ
4. ุงููุชูุฌุฉ: ูุฌุงุญ ุงูุจูุน โ
```

---

## ุงูุฃูุงู

### ุงูุญูุงูุฉ ุงูููุทุจูุฉ:
```javascript
// ุงููุชุฌุฑ ูุง ููููู:
โ ุชุญุฏูุซ ูุฑูุช ุงูุดุจูุฉ (available)
โ ุชุญุฏูุซ ูุฑูุช ูุชุงุฌุฑ ุฃุฎุฑู
โ ุชุบููุฑ ุฑูู ุงููุฑุช ุฃู ุงูุจุงูุฉ
โ ุญุฐู ุงููุฑูุช
โ ุชุญุฏูุซ ุญุงูุฉ ุฅูู ุบูุฑ 'sold'

// ุงููุชุฌุฑ ููููู ููุท:
โ ุชุญุฏูุซ ูุฑูุชู ุงููููููุฉ ุฅูู 'sold'
โ ุฅุถุงูุฉ soldAt ู soldTo
โ ููุท ุนูุฏ ุงูุจูุน ุงููุนูู
```

### ูุซุงู ุนูู ุงูุฑูุถ:
```javascript
// ูุญุงููุฉ ุชุญุฏูุซ ูุฑุช ูุชุงุญ โ ูุฑููุถ โ
resource.data.status == 'available'  // ููุณ 'transferred'

// ูุญุงููุฉ ุชุบููุฑ ุงูุจุงูุฉ โ ูุฑููุถ โ
request.resource.data.packageId != resource.data.packageId

// ูุญุงููุฉ ุชุญุฏูุซ ุฅูู ุญุงูุฉ ุฃุฎุฑู โ ูุฑููุถ โ
request.resource.data.status == 'available'  // ููุณ 'sold'
```

---

## ุงูุงุฎุชุจุงุฑ

### ุงูุณููุงุฑูู 1: ุจูุน ูุงุฌุญ
1. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ `posVendor`
2. ุงุฐูุจ ุฅูู: ุนูููุฉ ุจูุน
3. ุงุฎุชุฑ ุจุงูุฉ ููููุฉ
4. ุงุถุบุท "ุจูุน"
5. โ ูุฌุจ ุฃู ูุชู ุงูุจูุน ุจูุฌุงุญ
6. โ ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ ูุฌุงุญ
7. โ ูุฌุจ ุฃู ูุธูุฑ ุฑูู ุงููุฑุช ุงููุจุงุน

### ุงูุณููุงุฑูู 2: ุงูุชุญูู ูู ูุฎุฒูู ุงูุดุจูุฉ
1. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ `networkOwner`
2. ุงุฐูุจ ุฅูู: ุงููุฎุฒูู โ ุงููููููุฉ ูููุชุงุฌุฑ
3. ูุงุญุธ ุงูุนุฏุฏ ูุจู ุงูุจูุน (ูุซูุงู: 206)
4. ูู ุจุจูุน 5 ูุฑูุช ูู ุงููุชุฌุฑ
5. ุญุฏูุซ ุตูุญุฉ ุงููุฎุฒูู
6. โ ูุฌุจ ุฃู ูุชูุงูุต ุงูุนุฏุฏ โ 201
7. ุงุฐูุจ ุฅูู: ุงููุฎุฒูู โ ุงููุจุงุนุฉ
8. โ ูุฌุจ ุฃู ุชุฑู ุงูู 5 ูุฑูุช ุงููุจุงุนุฉ ููุง

### ุงูุณููุงุฑูู 3: ูุญุงููุฉ ุบูุฑ ูุตุฑุญ ุจูุง
1. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ `posVendor`
2. ุญุงูู ุชุญุฏูุซ ูุฑุช ูู `cards` collection ูุฏููุงู
3. ุญุงูู ุชุญุฏูุซ ุญููู ุบูุฑ `status, soldAt, soldTo`
4. โ ูุฌุจ ุฃู ููุฑูุถ ุงูุชุญุฏูุซ

---

## ุงูุชุบููุฑุงุช

### ุงููููุงุช ุงููุนุฏูุฉ:
1. โ `firestore.rules` - ุฅุถุงูุฉ ูุงุนุฏุฉ ููุณูุงุญ ุจุงูุจูุน
2. โ ุชู ูุดุฑ ุงูููุงุนุฏ ุฅูู Firebase

### ุงููุงุนุฏุฉ ุงูุฌุฏูุฏุฉ:
```javascript
allow update: if isVendor() && 
                resource.data.status == 'transferred' &&
                request.resource.data.status == 'sold' &&
                request.resource.data.keys().hasOnly(['status', 'soldAt', 'soldTo']);
```

---

## ููุงุญุธุงุช ูููุฉ

### ๐ ุงูุฃูุงู:
- โ ุงููุชุฌุฑ ููููู ููุท ุชุญุฏูุซ ูุฑูุชู ุงููููููุฉ
- โ ููุท ุฅูู ุญุงูุฉ `sold` (ูุง ูููู ุงูุนูุฏุฉ ูู `available`)
- โ ููุท ุงูุญููู ุงููุชุนููุฉ ุจุงูุจูุน

### โก ุงูุฃุฏุงุก:
- โ ุงูุชุญุฏูุซ ุงูููุฑู ูู Transaction ูุงุญุฏ
- โ ูุง ุงูุชุธุงุฑ ุฃู ุชุฃุฎูุฑ
- โ ูุชุฒุงูู ูู `vendor_cards` ู `cards`

### ๐ฏ ุงูุฏูุฉ:
- โ ุงูุชุญุฏูุซ ูู ููุณ ูุญุธุฉ ุงูุจูุน
- โ ูุง ูุงุฑู ุฒููู
- โ ุถูุงู ุงูุงุชุณุงู ูู ุงููุงุนุฏุฉ

---

## ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงููุฏุนููุฉ

### โ ูุณููุญ:
```javascript
// ุงูุจูุน ุงูุนุงุฏู
{
  status: 'transferred' โ 'sold',
  soldAt: Timestamp,
  soldTo: '777123456'
}
```

### โ ูุฑููุถ:
```javascript
// ูุญุงููุฉ ุชุญุฏูุซ ูุฑุช ูุชุงุญ
status: 'available' โ 'sold'  โ

// ูุญุงููุฉ ุชุนุฏูู ุญููู ุฃุฎุฑู
{
  status: 'sold',
  packageId: 'pkg_new'  โ
}

// ูุญุงููุฉ ุญุฐู
delete card  โ
```

---

## ุชุงุฑูุฎ ุงูุชุญุฏูุซ
**30 ุฃูุชูุจุฑ 2025** - ุชู ุฅุตูุงุญ ููุดุฑ ุงูููุงุนุฏ ุจูุฌุงุญ

## ุงูุญุงูุฉ
โ **ุงูุจูุน ูุนูู ุจูุฌุงุญ**
โ **ุงูุตูุงุญูุงุช ุขููุฉ ููุญุฏูุฏุฉ**
โ **ุงูุฃุฏุงุก ูุญุณูู**

