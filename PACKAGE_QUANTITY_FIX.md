# โ ุฅุตูุงุญ ุนุฑุถ ุงููููุฉ ุงููุชููุฑุฉ ููุจุงูุงุช

## ุงููุดููุฉ
ูู ุตูุญุฉ ุงูุดุจูุฉ โ ุชุจููุจ ุงูุจุงูุงุชุ ูุงูุช ุงููููุฉ ุงููุชููุฑุฉ ููู ุจุงูุฉ **ุบูุฑ ูุชุฒุงููุฉ** ูุน ุงููุฎุฒูู ุงููุนูู.

### ุงูุณุจุจ
- ูุงูุช `PackageCard` ุชุนุฑุถ `pkg.stock` ูู ูุณุชูุฏ ุงูุจุงูุฉ ูู `packages` collection
- ูุฐุง ุงูุญูู **ุซุงุจุช** ููุง ูุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ:
  - ุงุณุชูุฑุงุฏ ูุฑูุช ุฌุฏูุฏุฉ
  - ููู ูุฑูุช ูููุชุงุฌุฑ
  - ุจูุน ูุฑูุช ูู ุงููุชุงุฌุฑ

### ุงููุชูุฌุฉ
ุงููููุฉ ุงููุนุฑูุถุฉ ูุงูุช **ุบูุฑ ุฏูููุฉ** ููุง ุชุนูุณ ุงููุงูุน ุงููุนูู ูููุฎุฒูู.

---

## ุงูุญู ุงูููุทุจู

### 1๏ธโฃ ุฅูุดุงุก `_RealTimePackageCard` Widget
ุงุณุชุจุฏุงู `PackageCard` ุงูุซุงุจุช ุจู widget ุฌุฏูุฏ ูุณุชุฎุฏู `StreamBuilder` ูุฌูุจ ุงููููุฉ ุงููุนููุฉ:

```dart
class _RealTimePackageCard extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return StreamBuilder<int>(
      stream: _getAvailableCardsCount(networkId, package.id),
      builder: (context, snapshot) {
        final availableCount = snapshot.data ?? package.stock;
        
        return PackageCard(
          data: PackageCardData(
            quantityAvailable: availableCount, // โ ุงููููุฉ ุงููุนููุฉ!
            ...
          ),
        );
      },
    );
  }

  /// ุฌูุจ ุนุฏุฏ ุงููุฑูุช ุงููุชุงุญุฉ ูู ุงููุฎุฒูู ุงููุนูู
  Stream<int> _getAvailableCardsCount(String networkId, String packageId) {
    return FirebaseFirestore.instance
        .collection('cards')
        .where('networkId', isEqualTo: networkId)
        .where('packageId', isEqualTo: packageId)
        .where('status', isEqualTo: 'available')
        .snapshots()
        .map((snapshot) => snapshot.docs.length);
  }
}
```

### 2๏ธโฃ ุชุญุฏูุซ `network_page.dart`
- ุงุณุชุจุฏุงู `PackageCard` ุจู `_RealTimePackageCard`
- ุฅุถุงูุฉ import ูู `cloud_firestore` ู `PackageModel`

---

## ุงููุชูุฌุฉ

### โ ุงููููุฉ ุงูุขู ูุชุฒุงููุฉ ุชูุงูุงู ูุน ุงููุฎุฒูู
- **Real-time updates**: ุชุชุญุฏุซ ููุฑุงู ุนูุฏ ุฃู ุชุบููุฑ
- **ุฏูุฉ 100%**: ุชุนูุณ ุงูุนุฏุฏ ุงููุนูู ูููุฑูุช ุงููุชุงุญุฉ
- **ุชููุงุฆูุฉ**: ูุง ุญุงุฌุฉ ูุชุญุฏูุซ `pkg.stock` ูุฏููุงู

### ๐ ุงูุณููุงุฑูููุงุช ุงููุฏุนููุฉ

#### 1. ุงุณุชูุฑุงุฏ ูุฑูุช ุฌุฏูุฏุฉ
```
ูุจู: 100 ูุฑุช ูู ุงููุฎุฒูู
ุจุนุฏ ุงุณุชูุฑุงุฏ 50 ูุฑุช
ุงููุชูุฌุฉ: ุชุชุญุฏุซ ุงููููุฉ ููุฑุงู โ 150 ูุฑุช โ
```

#### 2. ููู ูุฑูุช ูููุชุงุฌุฑ
```
ูุจู: 150 ูุฑุช ูุชุงุญ
ุจุนุฏ ููู 30 ูุฑุช ููุชุฌุฑ
ุงููุชูุฌุฉ: ุชุชุญุฏุซ ุงููููุฉ ููุฑุงู โ 120 ูุฑุช โ
```

#### 3. ุญุฐู ูุฑูุช
```
ูุจู: 120 ูุฑุช ูุชุงุญ
ุจุนุฏ ุญุฐู 10 ูุฑูุช
ุงููุชูุฌุฉ: ุชุชุญุฏุซ ุงููููุฉ ููุฑุงู โ 110 ูุฑุช โ
```

---

## ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงูุณููุงุฑูู 1: ุงุณุชูุฑุงุฏ ูุฑูุช
1. ุณุฌูู ุฏุฎูู ุจุญุณุงุจ `networkOwner`
2. ุงุฐูุจ ุฅูู: ุงูุดุจูุฉ โ ุชุจููุจ ุงูุจุงูุงุช
3. ูุงุญุธ ุงููููุฉ ุงููุชููุฑุฉ ูุจุงูุฉ ูุนููุฉ (ูุซูุงู: 50 ูุฑุช)
4. ุงุฐูุจ ุฅูู: ุงููุฎุฒูู โ ุงุณุชูุฑุงุฏ ูุฑูุช
5. ุงุณุชูุฑุฏ 20 ูุฑุช ุฌุฏูุฏ ูููุณ ุงูุจุงูุฉ
6. โ ูุฌุจ ุฃู ุชุฑู ุงููููุฉ ุชุชุญุฏุซ ููุฑุงู โ 70 ูุฑุช

### ุงูุณููุงุฑูู 2: ููู ูุฑูุช
1. ูุงุญุธ ุงููููุฉ ุงููุชููุฑุฉ (70 ูุฑุช)
2. ุงุฐูุจ ุฅูู: ุงูุทูุจุงุช โ ุงุฎุชุฑ ุทูุจ ูุนูู
3. ูุงูู ุนูู ุงูุทูุจ (ุณูููู ูุฑูุช ูููุชุฌุฑ)
4. โ ูุฌุจ ุฃู ุชุฑู ุงููููุฉ ุชุชูุงูุต ููุฑุงู

### ุงูุณููุงุฑูู 3: ุญุฐู ูุฑูุช
1. ูุงุญุธ ุงููููุฉ ุงููุชููุฑุฉ
2. ุงุฐูุจ ุฅูู: ุงููุฎุฒูู โ ุงููุฑูุช ุงููุชุงุญุฉ
3. ุงุญุฐู ุจุนุถ ุงููุฑูุช
4. โ ูุฌุจ ุฃู ุชุฑู ุงููููุฉ ุชุชูุงูุต ููุฑุงู

---

## ููุงุญุธุงุช ุชูููุฉ

### ุงูุฃุฏุงุก
- โ **ูุนูุงู**: ูุณุชุฎุฏู Firestore snapshots ูุน composite index
- โ **ููุญุณูู**: ูู ุจุทุงูุฉ ุจุงูุฉ ููุง stream ูุณุชูู
- โ **ุณุฑูุน**: ุงูุชุญุฏูุซุงุช ุชุธูุฑ ููุฑุงู ุจุฏูู ุชุฃุฎูุฑ

### ุงูุฏูุฉ
- โ ูุนุฏ ููุท ุงููุฑูุช ุจุญุงูุฉ `available`
- โ ูุณุชุซูู ุงููุฑูุช ุงููููููุฉ (`transferred`)
- โ ูุณุชุซูู ุงููุฑูุช ุงููุจุงุนุฉ (`sold`)

### ุงูุชูุงูู
- โ ูุชูุงูู ูุน ุฌููุน ุนูููุงุช ุงููุฎุฒูู
- โ ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก ุงูุนุงู
- โ ูุนูู ูุน ุฃู ุนุฏุฏ ูู ุงูุจุงูุงุช

---

## Firestore Index ุงููุทููุจ

ุชุฃูุฏ ูู ูุฌูุฏ ูุฐุง Index ูู Firestore:

```
Collection: cards
Fields:
  - networkId (Ascending)
  - packageId (Ascending)
  - status (Ascending)
```

ุณูุชู ุฅูุดุงุคู ุชููุงุฆูุงู ุนูุฏ ุฃูู ุงุณุชุฎุฏุงู.

---

## ุชุงุฑูุฎ ุงูุชุญุฏูุซ
**30 ุฃูุชูุจุฑ 2025** - ุชู ุชุทุจูู ุงูุฅุตูุงุญ ุจูุฌุงุญ

